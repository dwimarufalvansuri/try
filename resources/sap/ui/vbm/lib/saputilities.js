 VBI.Utilities=VBI.Utilities||{};
HTMLCanvasElement.prototype.getPixelWidth=function(){if(this.m_pixelWidth)return this.m_pixelWidth;if(this.style.pixelWidth!==undefined)return this.style.pixelWidth;return parseInt(this.style.width)};
HTMLCanvasElement.prototype.getPixelHeight=function(){if(this.m_pixelHeight)return this.m_pixelHeight;if(this.style.pixelHeight!==undefined)return this.style.pixelHeight;return parseInt(this.style.height)};
HTMLCanvasElement.prototype.getPixelLeft=function(){if(this.m_pixelLeft)return this.m_pixelLeft;if(this.style.pixelLeft!==undefined)return this.style.pixelLeft;return parseInt(this.style.left)};
HTMLCanvasElement.prototype.getPixelTop=function(){if(this.m_pixelTop)return this.m_pixelTop;if(this.style.pixelTop!==undefined)return this.style.pixelTop;return parseInt(this.style.top)};
HTMLCanvasElement.prototype.setPixelWidth=function(v){if(this.m_pixelWidth)this.m_pixelWidth=v;(this.style.pixelWidth!==undefined)?(this.style.pixelWidth=v):(this.style.width=v+'px')};
HTMLCanvasElement.prototype.setPixelHeight=function(v){if(this.m_pixelHeight)this.m_pixelHeight=v;(this.style.pixelHeight!==undefined)?(this.style.pixelHeight=v):(this.style.height=v+'px')};
HTMLCanvasElement.prototype.setPixelLeft=function(v){(this.style.pixelLeft!==undefined)?(this.style.pixelLeft=v):(this.style.left=v+'px')};
HTMLCanvasElement.prototype.setPixelTop=function(v){(this.style.pixelTop!==undefined)?(this.style.pixelTop=v):(this.style.top=v+'px')};
VBI.Utilities.CreateWifiObject=function(){var n=document.createElement('object');if(!n)return null;n.classid="CLSID:00100000-2013-0070-2000-651572487E69";return n};
VBI.Utilities.CreateDOMElement=function(t,i,w,h){var n=document.createElement(t);n.style.height=w?w:"1px";n.style.width=h?h:"1px";n.id=i;return n};
VBI.Utilities.GetDOMElement=function(e){var a=[];for(var i=0,l=arguments.length;i<l;i++){var e=arguments[i];if(typeof e=='string'){e=document.getElementById(e)}if(arguments.length==1){return e}a.push(e)}return a};
VBI.Utilities.CreateDOMVBIDivElement=function(i,w,h){var n=document.createElement('div');n.id=i;n.style.height="300x";n.style.width="300px";n.style.overflow="hidden";n.style.position="absolute";n.style.left="0px";n.style.top="0px";return n};
VBI.Utilities.CreateGeoSceneDiv=function(i){var n=document.createElement('div');n.id=i;n.style.left="0px";n.style.top="0px";n.style.width="100%";n.style.height="100%";n.style.position="relative";n.style.overflow="hidden";return n};
VBI.Utilities.CreateGeoSceneCanvas=function(i,w,h,z,t,a){var n=document.createElement('canvas');n.id=i;n.style.left="0px";n.style.top="0px";n.width=w;n.height=h;n.style.width=w?(w+"px"):"512px";n.style.height=h?(h+"px"):"512px";n.style.position="absolute";n.style.zIndex=z;n.style.touchaction="none";n.className="vbi-geoscenecanvas";n.m_pixelWidth=null;n.m_pixelHeight=null;n.m_pixelLeft=null;n.m_pixelTop=null;n.m_bNotInDOM=(a!=undefined?a:false);n.m_CanvasValid=!n.m_bNotInDOM;if(n.m_bNotInDOM)n.m_nMoveCount=0;if(t!=undefined)n.tabIndex=t;return n};
VBI.Utilities.Align=['','left','center','','right'];
VBI.Utilities.CreateCaption=function(i,t,l,a,r,b,c,d,e,f){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[f];n.style.title=c;switch(e){case 3:n.style.fontSize="14px";n.style.fontWeight="bold";break}n.className="vbi-2d-caption vbi-2d-common";n.innerHTML=t;return n};
VBI.Utilities.CreateLabel=function(i,t,l,a,r,b,c,d){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.style.title=c;n.className="vbi-2d-label vbi-2d-common";n.innerHTML=t;return n};
VBI.Utilities.CreateLink=function(i,t,l,a,r,b,h,c,d){var n=document.createElement('a');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.className="vbi-2d-link vbi-2d-common";n.href=h?h:"javascript:void(0)";n.title=c;n.innerHTML=t;return n};
VBI.Utilities.CreateImage=function(i,a,l,t,r,b,c,d){var n=a.cloneNode(true);n.id=i;n.style.left=l+"px";n.style.top=t+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-t).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.className="vbi-2d-image vbi-2d-common";n.title=c;return n};
VBI.Utilities.CreateButton=function(i,t,l,a,r,b,c,d){var n=document.createElement('button');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.className="vbi-2d-button vbi-2d-common";n.innerHTML=t;n.title=c;return n};
VBI.Utilities.CreateCallout=function(i,l,t,w,h,z){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=t+"px";if(w)n.style.width=w?(w+"px"):"512px";if(h)n.style.height=h?(h+"px"):"300px";n.style.position="absolute";n.style.zIndex=z;n.className="vbi-callout";var a=document.createElement('div');a.id=i+"-window-content";a.style.position="relative";a.style.left="0px";a.style.top="0px";a.style.width="100%";a.style.height="100%";a.className="vbi-callout-content";var b=document.createElement('div');b.id=i+"-window-closebutton";b.className="vbi-callout-closebutton";n.appendChild(a);n.appendChild(b);var c;c=document.createElement('b');c.className="vbi-notch vbi-down";n.appendChild(c);c=document.createElement('b');c.className="vbi-border-notch vbi-notch";n.appendChild(c);return{m_Div:n,m_Content:a,m_CloseButton:b,GetAnchorPoint:function(){return[50,(style.paddingTop?parseInt(style.paddingTop):0)+(style.paddingBottom?parseInt(style.paddingBottom):0)+(style.height?parseInt(style.height):0)+(style.borderTop?parseInt(style.borderTop):0)+(style.borderBottom?parseInt(style.borderBottom):0)+ +40]}}};
VBI.Utilities.CreateDetailPhone=function(i,l,t,w,h,a,z,p){var d=document.createElement('div');d.id=i;d.style.left=l+"px";d.style.top=t+"px";d.style.zIndex=z;var b=12;var s=6;var c=14;b=VBI.Utilities.RemToPixel(0.750);s=VBI.Utilities.RemToPixel(0.375);c=VBI.Utilities.RemToPixel(0.875);if(h)d.style.minHeight=h+c+4+s+2*b+"px";d.className=".vbi-detail vbi-detail-phone";var e=document.createElement('div');e.id=i+"-window-header";e.className="vbi-detail-header-phone";d.appendChild(e);var f=document.createElement('div');f.id=i+"-window-title";f.className="vbi-detail-title-phone";f.innerHTML=a;e.appendChild(f);var g=document.createElement('div');g.id=i+"-window-close";g.className="vbi-detail-closebutton vbi-detail-closebutton-tablet";e.appendChild(g);var j=document.createElement('div');j.id=i+"-window-content";j.className="vbi-detail-content";j.style.fontSize=VBI.Utilities.RemToPixel(0.875)+"px";d.appendChild(j);return{m_Div:d,m_Content:j,m_CloseButton:g,m_Arrow:null,GetAnchorPoint:null}};
VBI.Utilities.CreateDetail=function(i,l,t,w,h,a,z,p){if(VBI.m_bIsPhone)return(VBI.Utilities.CreateDetailPhone(i,l,t,w,h,a,z,p));var d=document.createElement('div');d.id=i;d.style.left=l+"px";d.style.top=t+"px";d.style.zIndex=z;var P=VBI.m_bIsPhone;if(!P){var b=16;var s=16;var c=16;b=VBI.Utilities.RemToPixel(1);s=VBI.Utilities.RemToPixel(1);c=VBI.Utilities.RemToPixel(1);if(w)d.style.width=w+2*b+"px";if(h)d.style.minHeight=h+c+4+s+2*b+"px"}else{var e=12;var f=6;var g=14;e=VBI.Utilities.RemToPixel(0.750);f=VBI.Utilities.RemToPixel(0.375);g=VBI.Utilities.RemToPixel(0.875);if(h)d.style.minHeight=h+g+4+f+2*e+"px"}d.className="vbi-detail vbi-detail-border";var j=document.createElement('div');j.id=i+"-window-header";j.className="vbi-detail-header";d.appendChild(j);var k=document.createElement('div');k.id=i+"-window-title";k.className="vbi-detail-title";k.innerHTML=a;j.appendChild(k);var m=document.createElement('div');m.id=i+"-window-close";if(VBI.m_bIsMobile)m.className="vbi-detail-closebutton vbi-detail-closebutton-tablet";else m.className="vbi-detail-closebutton vbi-detail-closebutton-desktop";j.appendChild(m);var n=document.createElement('div');n.id=i+"-window-content";n.className="vbi-detail-content";d.appendChild(n);var o;o=document.createElement('b');o.className="vbi-detail-arrow vbi-detail-left";o.style.zIndex=z+1;if(!P)d.appendChild(o);var q=document.createElement('b');q.className="vbi-detail-arrow vbi-detail-left vbi-detail-border-arrow";q.style.zIndex=z;if(!P)d.appendChild(q);return{m_Div:d,m_Content:n,m_CloseButton:m,m_Arrow:o,GetAnchorPoint:function(){return[this.m_Arrow.offsetLeft,this.m_Arrow.offsetTop+this.m_Arrow.offsetHeight/2]}}};
VBI.Utilities.CreateGeoSceneDivCSS=function(i,c,t){var n=document.createElement('div');n.id=i;n.className=c;if(t)n.title=t;return n};
VBI.Utilities.CreateDOMColorShiftedImageFromData=function(d,c,e,l){var f=null,h=c?VBI.Types.string2rhls(c):null;if(!h)f=c?VBI.Types.string2rgba(c):null;var i=null,j=e?VBI.Types.string2rhls(e):null;if(!j)i=e?VBI.Types.string2rgba(e):null;var t=document.createElement('img');var k=document.createElement('img');if(l){t.onload=function(){if(typeof l==='function')l(t);this.onload=null};k.onload=function(){var m=document.createElement("canvas");var n=m.getContext("2d");m.width=k.width;m.height=k.height;n.drawImage(k,0,0,k.naturalWidth,k.naturalHeight,0,0,k.width,k.height);var p=n.getImageData(0,0,k.width,k.height);var d=p.data;function o(d,u,v,w){var r=d[u];var g=d[u+1];var b=d[u+2];var a=d[u+3];if(v){var x=VBI.Utilities.RGB2HLS(r,g,b);var y=VBI.Utilities.HLS2RGB(x[0]+v[0],x[1]*v[1],x[2]*v[2]);d[u]=Math.min(Math.round(y[0]),255);d[u+1]=Math.min(Math.round(y[1]),255);d[u+2]=Math.min(Math.round(y[2]),255);d[u+3]=Math.min(Math.round(v[3]*a),255)}else if(w){d[u]=w[0];d[u+1]=w[1];d[u+2]=w[2];if(d[u+3])d[u+3]=w[4]?Math.floor(Math.min(w[3]*255,255)):255}};for(var q=0,s=(k.width*k.height);q<s;++q){var u=q*4;if(h||f)o(d,u,h,f);if(j||i)o(d,u,j,i)}n.putImageData(p,0,0);t.src=m.toDataURL("image/png");this.onload=null}}k.src="data:image;base64,"+d;return t};
VBI.Utilities.CreateDOMImageFromData=function(d,l){var i=document.createElement('img');if(l){i.onload=function(){if(typeof l==='function')l(i);this.onload=null}}i.src="data:image;base64,"+d;return i};
VBI.Utilities.PtInRect=function(p,r){return((p[0]>r[0])&&(p[0]<r[2])&&(p[1]>r[1])&&(p[1]<r[3]))?true:false};
VBI.Utilities.RectIntersect=function(r,a){return!(a[0]>r[2]||a[2]<r[0]||a[3]<r[1]||a[1]>r[3])};
VBI.Utilities.RectOffset=function(r,n,a){r[0]+=n;r[1]+=a;r[2]+=n;r[3]+=a};
VBI.Utilities.cImg;
VBI.Utilities.GetImagePixelData=function(i){if(!VBI.Utilities.cImg){VBI.Utilities.cImg=document.createElement('canvas')}VBI.Utilities.cImg.width=i.naturalWidth;VBI.Utilities.cImg.height=i.naturalHeight;VBI.Utilities.cImg.style.width=(i.naturalWidth+"px");VBI.Utilities.cImg.style.height=(i.naturalHeight+"px");VBI.Utilities.cImg.style.top="0px";VBI.Utilities.cImg.style.left="0px";VBI.Utilities.cImg.style.position="absolute";var c=VBI.Utilities.cImg.getContext("2d");c.drawImage(i,0,0);var a=c.getImageData(0,0,VBI.Utilities.cImg.width,VBI.Utilities.cImg.height);return a};
VBI.Utilities.pointOnLine=function(p,x,y,d,c){var r=-1,s=d*d;var t,v,a;var f=VBI.Utilities.sqDistance;for(var n=0,l=p.length-1;n<l;++n){v=p[n];a=p[n+1];if((t=f(v[0],v[1],a[0],a[1],x,y))<s){s=t;r=n}}if(c&&(l>0)){v=p[0];a=p[l];if((t=f(v[0],v[1],a[0],a[1],x,y))<s){s=t;r=n}}return r};
VBI.Utilities.pointInPolygon=function(p,x,y){var v,a,b=p.length;for(var c=false,n=-1,l=b,d=l-1;++n<l;d=n){v=p[n];a=p[d];((v[1]<=y&&y<a[1])||(a[1]<=y&&y<v[1]))&&(x<(a[0]-v[0])*(y-v[1])/(a[1]-v[1])+v[0])&&(c=!c)}return c};
VBI.Utilities.pointInTriangle=function(t,p){var a=t[2][0]-t[0][0];var b=t[2][1]-t[0][1];var c=t[1][0]-t[0][0];var d=t[1][1]-t[0][1];var e=p[0]-t[0][0];var f=p[1]-t[0][1];var g=a*a+b*b;var h=a*c+b*d;var i=a*e+b*f;var j=c*c+d*d;var k=c*e+d*f;var n=1/(g*j-h*h);var u=(j*i-h*k)*n;var v=(g*k-h*i)*n;return((u>=0)&&(v>=0)&&(u+v<1))};
VBI.Utilities.updateBoundRect=function(a,r){var x,n=a.length;var m=r[0];var b=r[2];var c=r[1];var d=r[3];for(var e=0;e<n;++e){x=a[e];if(m>x[0])m=x[0];if(b<x[0])b=x[0];if(c>x[1])c=x[1];if(d<x[1])d=x[1]}r[0]=m;r[2]=b;r[1]=c;r[3]=d};
VBI.Utilities.inflateRect=function(r,v){r[0]-=v;r[1]-=v;r[2]+=v;r[3]+=v};
VBI.Utilities.sqDistance=function(x,y,a,b,c,d){var p=a-x;var e=b-y;var s=p*p+e*e;if(!s)return(c-x)*(c-x);var u=((c-x)*p+(d-y)*e)/s;if(u>1)u=1;else if(u<0)u=0;var f=x+u*p-c;var g=y+u*e-d;return f*f+g*g};
VBI.Utilities.DrawSelectIndicator=function(c,p){var r=4;c.lineWidth=1;c.strokeStyle='rgba( 0, 0, 0, 1.0 )';c.fillStyle='rgba( 10, 10, 255, 1.0 )';c.beginPath();c.arc(p[0],p[1],r,0,2*Math.PI);c.closePath();c.fill();c.stroke()};
VBI.Utilities.DrawDesignRect=function(c,a,p,b,d,e){var x,y,r=3,D=c.setLineDash?true:false;c.save();c.lineWidth=1;c.strokeStyle='rgba( 0, 0, 0, 1.0 )';if(typeof p=='object'){var w=p[2]-p[0];var h=p[3]-p[1];var f=w/2;var g=h/2;if(D)c.setLineDash([1,2]);c.strokeRect(p[0],p[1],w,h);var i='rgba( 255, 255, 255, 1.0 )';var j='rgba( 128, 128, 128, 1.0 )';if(D)c.setLineDash([0,0]);c.fillStyle=i;for(x=0;x<3;++x)for(y=0;y<3;++y){if(!a[y*3+x])c.fillStyle=j;else c.fillStyle=i;if(x==1&&y==1)continue;c.beginPath();c.arc(p[0]+x*f,p[1]+y*g,r,0,2*Math.PI);c.closePath();c.fill();c.stroke()}}else{c.strokeRect(p-1,b-1,d-p,e-b);c.strokeStyle='rgba( 255, 255, 255, 1.0 )';c.strokeRect(p,b,d-p,e-b)}c.restore()};
VBI.Utilities.DrawFrameRect=function(c,a,p,b,d,e){c.lineWidth=1;c.strokeStyle=a;if(typeof p=='object')c.strokeRect(p[0],p[1],p[2]-p[0],p[3]-p[1]);else c.strokeRect(p,b,d-p,e-b)};
VBI.Utilities.AssembleCopyrightString=function(C,a,b){var r=/\{LINK\|IMG\}/;var c=/\{IMG\}/;var d=/\{LINK\|([^\}]+)\}/;if(C){var t=C.replace(r,"<a href='"+a+"'><img src='"+b+"' width='10' height='10' border='none'></a>");t=t.replace(c,"<img src='"+b+"' width='10' height='10' border='none' >");return t.replace(d,"<a  href='"+a+"'>$1</a>")}return C};
VBI.Utilities.DrawTrackingRect=function(c,p,a,b,d){c.save();c.strokeStyle='black';c.lineWidth=1;if(c.setLineDash)c.setLineDash([1,2]);c.beginPath();c.rect(p,a,b-p,d-a);c.stroke();c.fillStyle='rgba( 0, 192, 192, 0.2 )';c.fill();c.restore()};
VBI.Utilities.RGB2HLS=function(r,g,b){r/=255.0,g/=255.0,b/=255.0;var m=Math.max(r,g,b);var a=Math.min(r,g,b);var h=0,s,l=(m+a)/2;if(m==a){h=s=0}else{var d=m-a;s=l>0.5?d/(2-m-a):d/(m+a);switch(m){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return[h,l,s]};
VBI.Utilities.HLS2RGB=function(h,l,s){var r=0,g=0,b=0;if(s==0){r=g=b=l}else{function H(p,q,t){if(t<0)t+=1;else if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p};var q=l<0.5?l*(1+s):l+s-l*s;var p=2*l-q;r=H(p,q,h+1/3);g=H(p,q,h);b=H(p,q,h-1/3)}return[r*255,g*255,b*255]};
VBI.Utilities.RemToPixel=function(v){return v*parseFloat(getComputedStyle(document.documentElement).fontSize)};
