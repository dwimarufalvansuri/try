
VBI.Utilities.SceneBindDesignSpotBoxSize=function(o){var s=this.m_Scene;if(o.m_Design&&(o.m_Hit==VBI.HTBOXHANDLE)&&this.m_Scale.IsChangeable(s.m_Ctx)){if(o.m_Handle>6)return;var z=s.GetCurrentZoomFactors();var n=o.m_ClientX/z[0];var a=o.m_ClientY/z[1];var b=o.m_DhOrig[0];var m=(b[0]+b[2])/2.0;var w=(b[2]-b[0])/2.0;var h=(b[3]-b[1]);var f=1.0,c=1.0;switch(o.m_Handle){case 1:c=Math.abs(a-b[3])/h;break;case 2:c=Math.abs(a-b[3])/h;case 5:f=Math.abs(n-m)/w;break;case 0:c=Math.abs(a-b[3])/h;case 3:f=Math.abs(n-m)/w;break}var d=o.m_ScaleOrig.slice(0);d[0]*=f;d[1]*=c;this.m_Scale.SetValueVector(s.m_Ctx,d)}};
VBI.Utilities.SceneBindDesignBoxBoxSize=function(k,o){var s=this.m_Scene;if(o.m_Design&&(o.m_Hit==VBI.HTBOXHANDLE)&&this.m_Scale.IsChangeable(s.m_Ctx)){var z=s.GetCurrentZoomFactors();var n=o.m_ClientX/z[0];var a=o.m_ClientY/z[1];var b=o.m_DhOrig[0];var m=(b[0]+b[2])/2.0;var c=(b[1]+b[3])/2.0;var w=(b[2]-b[0])/2.0;var h=(b[3]-b[1])/2.0;var f=1.0,d=1.0;switch(o.m_Handle){case 0:case 2:case 6:case 8:f=Math.abs(n-m)/w;d=Math.abs(a-c)/h;if(k)f=d=Math.max(f,d);break;case 1:case 7:d=Math.abs(a-c)/h;if(k)f=d;break;case 3:case 5:f=Math.abs(n-m)/w;if(k)d=f;break}var e=o.m_ScaleOrig.slice(0);e[0]*=f;e[1]*=d;this.m_Scale.SetValueVector(s.m_Ctx,e)}};
VBI.Utilities.SceneBindMeterRadiusDesignBoxSize=function(o){var s=this.m_Scene;if(o.m_Design){var c=this.m_Pos.GetValueVector(s.m_Ctx);var a=s.GetPosFromPoint([o.m_ClientX,o.m_ClientY,0]);var r=0;switch(o.m_Handle){case 1:case 7:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(c),VBI.MathLib.DegToRad([c[0],a[1]]));break;case 3:case 5:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(c),VBI.MathLib.DegToRad([a[0],c[1]]));break}this.m_Radius.SetValueFloat(s.m_Ctx,Math.abs(r))}};
VBI.Utilities.SceneBindRadiusDesignBoxSize=function(o){var s=this.m_Scene;if(o.m_Design){var c=this.m_Pos.GetValueVector(s.m_Ctx);var a=s.GetPointFromPos(c);var r=0;switch(o.m_Handle){case 1:case 7:r=(a[1]-o.m_ClientY);break;case 3:case 5:r=(a[0]-o.m_ClientX);break}this.m_Radius.SetValueFloat(s.m_Ctx,Math.abs(r))}};
VBI.Utilities.SceneBindPosArrayDesignBoxSize=function(o){var s=this.m_Scene;if(o.m_Design){var p=s.GetPosFromPoint([o.m_ClientX,o.m_ClientY,0]);var m=Number.MAX_VALUE;var a=-Number.MAX_VALUE;var b=Number.MAX_VALUE;var c=-Number.MAX_VALUE;var d=o.m_PosOrig.slice(0);var n,l=d.length/3,i;for(n=0;n<l;++n){i=n*3;if(m>d[i])m=d[i];if(a<d[i])a=d[i];if(b>d[i+1])b=d[i+1];if(c<d[i+1])c=d[i+1]}var e=0,f=1;var g=0,h=1;switch(o.m_Handle){case 0:e=a;f=(p[0]-a)/(m-a);case 1:g=b;h=(p[1]-b)/(c-b);break;case 2:g=b;h=(p[1]-b)/(c-b);case 5:e=m;f=(p[0]-m)/(a-m);break;case 6:g=c;h=(p[1]-c)/(b-c);case 3:e=a;f=(p[0]-a)/(m-a);break;case 8:e=m;f=(p[0]-m)/(a-m);case 7:g=c;h=(p[1]-c)/(b-c);break}for(n=0;n<l;++n){var i=n*3;d[i]=e+(d[i]-e)*f;d[i+1]=g+(d[i+1]-g)*h}this.m_Pos.SetValueVector(s.m_Ctx,d)}};
VBI.NodeProperty=function(d,n,p,c){var a=null;if(!(a=d[n]))a=d[n+".bind"];this.m_NPath=a.split(".");this.m_Path=a.split(".");this.m_PNP=p;this.m_nCurElement=0;this.m_CurElement=null;this.m_DTN=c.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path);var t=this;while(t=t.m_PNP){if(c.m_DataTypeProvider.isParentOf(t.m_DTN,this.m_DTN)){var b,e=t.m_DTN.GetPath();for(b=0;b<e.length;++b){if(this.m_NPath[0]==e[b])this.m_NPath.splice(0,1);else break}break}}this.m_PNP=t;this.NotifyDataChange=function(c){this.m_CurElement=null;this.m_DTN=c.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path)};this.clear=function(){this.m_PNP=null;this.m_CurElement=null;this.m_DTN=null;this.m_NPath=null;this.m_Path=null};this.GetCurrentElement=function(c){if(this.m_CurElement)return this.m_CurElement;var f=this.GetCurrentNode(c);if(!f)return null;return(this.m_CurElement=f.m_dataelements[this.m_nCurElement])};this.GetIndexedElement=function(c,i){var f=this.GetCurrentNode(c);if(!f)return null;return f.m_dataelements[i]};this.GetCurrentNode=function(c){var f=null;if(this.m_PNP){var g=this.m_PNP.GetCurrentElement(c);f=g.FindNodeFromPath(this.m_NPath)}else{f=c.m_DataProvider.FindNodeFromPath(this.m_NPath)}return f};this.Select=function(i){this.m_CurElement=null;this.m_nCurElement=i};this.SetEditMode=function(c,m){var f;if(f=this.GetCurrentElement(c))f.m_EditMode=m};this.GetEditMode=function(c){var f;if((f=this.GetCurrentElement(c))&&(f.m_EditMode!=undefined))return f.m_EditMode;return VBI.EMHandle};this.IsElementSelected=function(c){var f;if(f=this.GetCurrentElement(c))return f.IsSelected();return false};this.SetSelected=function(c,s){return};return this};
VBI.AttributeProperty=function(d,n,p,c,a){var v;this.m_DefaultValue=a;if(v=d[n]){this.m_Name=n;this.m_Value=v}else if(v=d[n+".bind"]){this.m_PNP=p;this.m_Name=n;this.m_RelBind=v.split(".");this.m_AbsBind=v.split(".");this.m_DTA=c.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind);var t=this;while(t=t.m_PNP){if(c.m_DataTypeProvider.isParentOf(t.m_DTN,this.m_DTA)){var b,e=t.m_DTN.GetPath();for(b=0;b<e.length;++b){if(this.m_RelBind[0]==e[b])this.m_RelBind.splice(0,1);else break}break}}this.m_PNP=t}this.NotifyDataChange=function(c){if(this.m_AbsBind)this.m_DTA=c.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind)};this.clear=function(){this.m_PNP=null;this.m_DTA=null};this.IsChangeable=function(c){var f;if(f=this.GetAttributeObject(c))return f.IsChangeable();return false};this.GetAttributeObject=function(c){if(this.m_RelBind){if(this.m_PNP)return this.m_PNP.GetCurrentElement(c).FindAttributeFromPath(this.m_RelBind);else return c.m_DataProvider.FindAttributeFromPath(this.m_RelBind)}return null};this.GetValueFloat=function(c){if(this.m_Value)return VBI.Types.string2float(this.m_Value);if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if(f.m_dta.m_Type==VBI.Types.st_float)return f.m_Value;if(f.m_dta.m_Type==VBI.Types.st_string)return VBI.Types.string2float(f.m_Value);if(f.m_dta.m_Type==VBI.Types.st_long)return VBI.Types.long2float(f.m_Value);if(f.m_dta.m_Type==VBI.Types.st_bool)return f.m_Value?1.0:0.0}}return this.m_DefaultValue};this.GetValueString=function(c){if(this.m_Value)return this.m_Value;if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if(f.m_dta.m_Type==VBI.Types.st_string)return f.m_Value;else return f.GetStringValue()}};return this.m_DefaultValue};this.GetValueLong=function(c){if(this.m_Value)return VBI.Types.string2long(this.m_Value);if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if(f.m_dta.m_Type==VBI.Types.st_long)return f.m_Value;if(f.m_dta.m_Type==VBI.Types.st_bool)return f.m_Value;if(f.m_dta.m_Type==VBI.Types.st_string)return VBI.Types.string2long(f.m_Value);if(f.m_dta.m_Type==VBI.Types.st_float)return VBI.Types.float2long(f.m_Value)}};return this.m_DefaultValue};this.GetValueBool=function(c){if(this.m_Value)return VBI.Types.string2bool(this.m_Value);if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if(f.m_dta.m_Type==VBI.Types.st_bool)return f.m_Value;if(f.m_dta.m_Type==VBI.Types.st_string)return VBI.Types.string2bool(f.m_Value)}};return this.m_DefaultValue};this.GetValueVector=function(c){if(this.m_Value)return VBI.Types.string2vector(this.m_Value);if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if((f.m_dta.m_Type==VBI.Types.st_vector)||(f.m_dta.m_Type==VBI.Types.st_vectorarray))return f.m_Value;if(f.m_dta.m_Type==VBI.Types.st_string)return VBI.Types.string2vector(f.m_Value)}}return this.m_DefaultValue};this.GetValueColor=function(c){if(this.m_Value)return VBI.Types.string2color(this.m_Value);if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if((f.m_dta.m_Type==VBI.Types.st_color))return f.m_Value;if(f.m_dta.m_Type==VBI.Types.st_string)return VBI.Types.string2color(f.m_Value)}}return this.m_DefaultValue};this.SetValueVector=function(c,v){if(this.m_Value)return null;if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if((f.m_dta.m_Type==VBI.Types.st_vector)||(f.m_dta.m_Type==VBI.Types.st_vectorarray))f.set(v);if(f.m_dta.m_Type==VBI.Types.st_string)f.set(VBI.Types.float2string(v))}}return null};this.SetValueFloat=function(c,v){if(this.m_Value)return null;if(this.m_RelBind){var f;if(f=this.GetAttributeObject(c)){if((f.m_dta.m_Type==VBI.Types.st_float))f.set(v);if(f.m_dta.m_Type==VBI.Types.st_string)f.set(VBI.Types.float2string(v))}}return null};this.IsBound=function(){return this.m_RelBind?true:false};return this};
VBI.VisualObjects=function(){VBI.EMHandle=0;VBI.EMBox=1;VBI.HTHANDLE=0;VBI.HTBOX=1;VBI.HTBOXHANDLE=2;var v={};v.vbiclass="VisualObjects";v.Factory={"{00100000-2012-0004-B001-64592B8DB964}":function(){return new VBI.VisualObjects.Spot()},"{00100000-2012-0004-B001-C46BD7336A1A}":function(){return new VBI.VisualObjects.Route()},"{00100000-2013-0004-B001-7EB3CCC039C4}":function(){return new VBI.VisualObjects.Circle()},"{00100000-2013-0004-B001-686F01B57873}":function(){return new VBI.VisualObjects.CircleDist()},"{00100000-2012-0004-B001-383477EA1DEB}":function(){return new VBI.VisualObjects.Pie()},"{00100000-2012-0004-B001-BFED458C3076}":function(){return new VBI.VisualObjects.Box()},"{00100000-2012-0004-B001-F311DE491C77}":function(){return new VBI.VisualObjects.Area()},"{00100000-2013-1000-1100-50059A6A47FA}":function(){return new VBI.VisualObjects.Caption()},"{00100000-2013-1000-3700-AD84DDBBB31B}":function(){return new VBI.VisualObjects.Label()},"{00100000-2013-1000-2400-D305F7942B98}":function(){return new VBI.VisualObjects.Link()},"{00100000-2013-1000-2200-6B060A330B2C}":function(){return new VBI.VisualObjects.Image()},"{00100000-2013-1000-1200-855B919BB0E9}":function(){return new VBI.VisualObjects.Button()},};v.Factory.CreateInstance=function(c){return v.Factory[c]()};VBI.VisualObjects.Base={m_Props:null,m_Scene:null,m_BB:[],m_IO:[],m_colorHot:'rgba( 240, 171, 0, 0.5 )',m_defaultColor:'rgba( 255, 0, 0, 1.0 )',m_defaultTooltip:'',m_DH:[],m_szHandle:8,m_Track:null,BaseLoad:function(d,c,i){VBI.m_bTrace&&VBI.Trace("BaseLoad");i.m_Props.push(i.m_HotScale=new VBI.AttributeProperty(d,'hotScale',i.m_DataSource,c,[1.0,1.0,1.0]));i.m_Props.push(i.m_HotDeltaColor=new VBI.AttributeProperty(d,'hotDeltaColor',i.m_DataSource,c,null));i.m_Props.push(i.m_SelectColor=new VBI.AttributeProperty(d,'selectColor',i.m_DataSource,c,null));i.m_Props.push(i.m_FxSize=new VBI.AttributeProperty(d,'fxsize',i.m_DataSource,c,true));i.m_Props.push(i.m_FxDir=new VBI.AttributeProperty(d,'fxdir',i.m_DataSource,c))},BaseMousemove:function(e){VBI.m_bTrace&&VBI.Trace("BaseMousemove");if(this.m_Track)return false;if(!this.GetHitArray)return false;var h=this.GetHitArray(e.offsetX,e.offsetY);if(h.length>0){var s=this.m_Scene;s.RenderAsync();s.InternalSetHotItem(this,h[0]);if(!h[0].m_Design&&this.m_Tooltip){this.m_DataSource.Select(h[0].m_Index);s.SetToolTip(this.m_Tooltip.GetValueString(s.m_Ctx))}var c;if(c=this.DetailCursor(e,h[0])){s.SetCursor(c)}}return h.length>0?true:false},BaseContextmenu:function(e){VBI.m_bTrace&&VBI.Trace("BaseContextmenu");if(!this.GetHitArray)return false;var h=this.GetHitArray(e.offsetX,e.offsetY);if(h.length>0){var s=this.m_Scene,a=h[0];var b=this.m_DataSource.GetIndexedElement(s.m_Ctx,a.m_Index);var c,d=s.m_Ctx.m_Actions;if(d&&a.m_Design&&(a.m_Hit==VBI.HTHANDLE)){if(c=d.findAction("HandleContextMenu",s,this)){var p=s.GetEventVPCoordsObj(e);p.handle=a.m_Handle.toString();this.m_Scene.m_Ctx.FireAction(c,s,this,b,p);e.preventDefault();return true}}if(this.DetailContextmenu(e,b,h[0])){e.preventDefault();return true}if(d){if(c=d.findAction("ContextMenu",s,this))this.m_Scene.m_Ctx.FireAction(c,s,this,b,s.GetEventVPCoordsObj(e))}e.preventDefault()}return h.length>0?true:false},BaseClick:function(e){VBI.m_bTrace&&VBI.Trace("BaseClick");if(!this.GetHitArray)return false;var s=this.m_Scene;var h=this.GetHitArray(e.offsetX,e.offsetY);if(!h.length)return false;this.m_DataSource.Select(h[0].m_Index);s.RenderAsync();var a;if(a=this.m_DataSource.GetIndexedElement(s.m_Ctx,h[0].m_Index)){if((e.type.indexOf("touch")>=0)||(e.type.indexOf("pointer")>=0))a.Select(this.IsSelected(s.m_Ctx)?false:true);else if(e.shiftKey==true)a.Select(true);else if(e.ctrlKey==true)a.Select(this.IsSelected(s.m_Ctx)?false:true);else{a.GlobalSingleSelect()}}if(this.IsPosChangeable(s.m_Ctx)){var b=this.m_DataSource.GetEditMode(s.m_Ctx)==VBI.EMHandle?VBI.EMBox:VBI.EMHandle;VBI.m_bTrace&&VBI.Trace("SetEditMode: "+b);this.m_DataSource.SetEditMode(s.m_Ctx,b);e.preventDefault();return true}if(this.DetailClick(e,a,h[0])){e.preventDefault();return true}var c;if(c=s.m_Ctx.m_Actions){var d;if(d=c.findAction("Click",s,this)){this.m_Scene.m_Ctx.FireAction(d,s,this,a,s.GetEventVPCoordsObj(e));e.preventDefault();return true}}return h.length>0?true:false},BaseHitTest:function(n,a,o){var t,h=[];var p=VBI.Utilities.PtInRect;var b={};if(this.BaseDesignHitTest(n,a,b)){h.push(b);return h}for(var c=this.m_BB.length-1;c>=0;--c){if(t=this.m_BB[c])for(var d=this.m_IO[c].length-1;d>=0;--d){var e=this.m_IO[c][d];if(!p([n-e,a],t))continue;if(o){var r=o.m_cb(o,c,n-e,a);if(r&&r.m_hit>0){h.push({m_Index:c,m_Detail:r});if(r.m_hit==1)return h}}}}return h},clear:function(){if(this.m_Props){for(var n=0;n<this.m_Props.length;++n)this.m_Props[n].clear();this.m_Props=null}this.m_Scene=null;this.m_Track=null;m_BB=null;m_IO=null;m_DH=null},load:function(i,d,c){if(d.id)i.m_ID=d.id;this.m_Props=[]},NotifyDataChange:function(c){if(this.m_Props){for(var n=0,l=this.m_Props.length;n<l;++n)this.m_Props[n].NotifyDataChange(c)}},IsPosChangeable:function(c){if(this.m_Pos)return this.m_Pos.IsChangeable(c);return false},IsSelected:function(c){if(this.m_DataSource)return this.m_DataSource.IsElementSelected(c);return false},IsHandleMode:function(){return this.m_DataSource.GetEditMode(this.m_Scene.m_Ctx)==VBI.EMHandle?true:false},IsBoxMode:function(){return this.m_DataSource.GetEditMode(this.m_Scene.m_Ctx)==VBI.EMBox?true:false},IsHot:function(i){var h=this.m_Scene.m_HotItem;if(h.m_Index!=i)return false;if(h.m_Design)return false;if(h.m_VO!=this)return false;if(!(actions=this.m_Scene.m_Ctx.m_Actions)||!actions.findAction(null,this.m_Scene,this))return false;return true},BaseRender:function(c,d){var l=this.m_DH.length;if(!l)return;var t,a,b;var s=this.m_szHandle,h=s/2,e=1.5*s*s;var f=d.fillStyle;var g='rgba(255,132,0,1.0)';var i='rgba(188,54,24,1.0)';var j='rgba( 240, 171, 0, 1.0 )';var k=this.m_Scene.m_HotItem;var H,x,S=false;for(var n=0;n<l;++n){if(!(H=this.m_DH[n]))continue;for(var m=0,o=this.m_IO[n].length;m<o;++m){d.setTransform(1.0,0.0,0.0,1.0,this.m_IO[n][m],0.0);if(H.m_EditMode==VBI.EMBox){if(H.length==1){x=H[0];VBI.Utilities.DrawDesignRect(d,this.DesignGetActiveBoxHandles(n),x)}}else{d.fillStyle=i;d.lineWidth=1;t=null;if(S){d.fillStyle=i;S=false}for(var p=0,q=H.length;p<q;++p){x=H[p];var r=(k.m_VO==this&&k.m_Index==n&&k.m_Design&&k.m_HitObj&&k.m_HitObj.m_Handle==p);if(t&&(((a=(t[0]-x[0]))*a)+((b=(t[1]-x[1]))*b))<e){if(!S){S=true;d.fillStyle=r?g:j;d.fill()}continue}if(S){d.fillStyle=i;S=false}if(r)d.fillStyle=j;d.beginPath();d.rect(x[0]-h,x[1]-h,s,s);d.closePath();d.fill();if(r)d.fillStyle=i;t=x}}}}d.fillStyle=f;d.setTransform(1.0,0.0,0.0,1.0,0.0,0.0)},BaseDesignHitTest:function(n,a,b){VBI.m_bTrace&&VBI.Trace("BaseDesignHitTest nsx:"+n+" nsy:"+a+" instance:"+this.m_ID);var l=this.m_DH.length;if(!l)return false;var s=this.m_szHandle,c=s/2.0;var P=VBI.Utilities.PtInRect;if(b.m_Handle)delete b.m_Handle;var H,d;for(var e=l;e>=0;--e){if(!(H=this.m_DH[e]))continue;for(var f=0;f<this.m_IO[e].length;++f){var g=this.m_IO[e][f];if(H.m_EditMode==VBI.EMHandle){VBI.m_bTrace&&VBI.Trace("BaseDesignHitTest Handle");for(var i=0,j=H.length;i<j;++i){d=H[i];if(P([n-g,a],[d[0]-c,d[1]-c,d[0]+c,d[1]+c])){VBI.m_bTrace&&VBI.Trace("BaseDesignHitTest Handle Hit! Index:"+e+" Handle: "+i);b.m_Index=e;b.m_Design=true;b.m_Hit=VBI.HTHANDLE;b.m_Handle=i;b.m_NsX=n;b.m_NsY=a;return true}}}else if(H.m_EditMode==VBI.EMBox){VBI.m_bTrace&&(H.length>1||H.length==0)&&VBI.Trace("Error: Box edit mode must fill one rectangle only");d=H[0];VBI.m_bTrace&&VBI.Trace("BaseDesignHitTest Box");var r=9;var w=d[2]-d[0];var h=d[3]-d[1];var k=w/2;var m=h/2;var o=this.DesignGetActiveBoxHandles(e);for(var x=0;x<3;++x)for(var y=0;y<3;++y){if(x==1&&y==1)continue;if(!o[y*3+x])continue;var p=d[0]+x*k-(n-g);var q=d[1]+y*m-(a);if((p*p+q*q)<r){b.m_Index=e;b.m_Handle=y*3+x;b.m_Design=true;b.m_Hit=VBI.HTBOXHANDLE;b.m_NsX=n;b.m_NsY=a;return true}}if(P([n-g,a],d)){VBI.m_bTrace&&VBI.Trace("BaseDesignHitTest Box Hit! Index:"+e);b.m_Index=e;b.m_Handle=-1;b.m_Design=true;b.m_Hit=VBI.HTBOX;b.m_NsX=n;b.m_NsY=a;return true}}}}return false},DesignHandleDrag:function(o,e){var s=this.m_Scene;VBI.m_bTrace&&VBI.Trace("DesignHandleDrag");VBI.m_bTrace&&(s.m_nInputMode!=VBI.InputModeTrackObject)&&VBI.Trace("Error: DesignHandleDrag wrong input mode: "+s.m_nInputMode);this.m_DataSource.Select(o.m_Index);var p=s.GetPosFromPoint([o.m_ClientX,o.m_ClientY,0]);var a=s.GetPosFromPoint([o.m_ClientStartX,o.m_ClientStartY,0]);if(this.IsPosChangeable(s.m_Ctx)){var b=this.m_Pos.GetValueVector(s.m_Ctx).slice(0);var c=o.m_PosOrig;if(o.hasOwnProperty('m_Handle')){VBI.m_bTrace&&VBI.Trace("DesignHandleDrag Handle");if(o.m_Hit==VBI.HTHANDLE){var i=o.m_Handle*3;b[i]=p[0];b[i+1]=p[1];this.m_Pos.SetValueVector(s.m_Ctx,b)}else if(o.m_Hit==VBI.HTBOXHANDLE){if(this.DesignBoxSize)this.DesignBoxSize(o)}else if(o.m_Hit==VBI.HTBOX){VBI.m_bTrace&&VBI.Trace("DesignHandleDrag Box");var d=(p[0]-a[0]);var f=(p[1]-a[1]);for(var n=0,l=b.length/3;n<l;++n){var i=n*3;b[i]=c[i]+d;b[i+1]=c[i+1]+f}this.m_Pos.SetValueVector(s.m_Ctx,b)}}}s.RenderAsync()},DesignHandleDrop:function(o,e){var s=this.m_Scene;VBI.m_bTrace&&(s.m_nInputMode!=VBI.InputModeTrackObject)&&VBI.Trace("Error: DesignHandleDrop wrong input mode: "+s.m_nInputMode);var a,b=s.m_Ctx.m_Actions;if(b&&o.m_Design){if(a=b.findAction("HandleMoved",s,this)){var c;if(c=this.m_DataSource.GetIndexedElement(s.m_Ctx,o.m_Index)){var p=s.GetEventVPCoordsObj(e);p.handle=o.m_Handle.toString();p.mode=o.m_Hit.toString();s.m_Ctx.FireAction(a,s,this,c,p)}}}s.SetInputMode(VBI.InputModeDefault);s.RenderAsync();return true},DesignHandleEnd:function(o,e){this.m_Track.UnHook();this.m_Track=null},DesignGetActiveBoxHandles:function(i){return[1,1,1,1,0,1,1,1,1]},onsapsecclick:function(e){return this.BaseContextmenu(e)},onsapclick:function(e){return this.BaseClick(e)},onsapmove:function(e){return this.BaseMousemove(e)},onsapup:function(e){if(!this.m_Track)return false;this.m_Track.UnHook();this.m_Track=null},onsapdown:function(e){VBI.m_bTrace&&VBI.Trace("onsapdown in base "+e.type);var s=this.m_Scene;if(this.m_Track){VBI.m_bTrace&&VBI.Trace("Error: Track object should be already gone");return true}if(!this.GetHitArray)return false;var h,a=this.GetHitArray(e.offsetX,e.offsetY);if(a.length&&(h=a[0]).m_Design){VBI.m_bTrace&&VBI.Trace("Start Tracking on "+this.m_ID+" caused by "+e.type);this.m_DataSource.Select(h.m_Index);h.m_CBDrag=this.DesignHandleDrag.bind(this);h.m_CBDrop=this.DesignHandleDrop.bind(this);h.m_CBEnd=this.DesignHandleEnd.bind(this);h.m_ClientStartX=e.offsetX;h.m_ClientStartY=e.offsetY;h.m_PosOrig=this.m_Pos.GetValueVector(s.m_Ctx).slice(0);s.SetInputMode(VBI.InputModeTrackObject);s.SetCursor(this.DetailCursor(e,h));if(this.DesignBeginDrag)this.DesignBeginDrag(h);this.m_Track=new s.DesignTrack(h);e.stopPropagation();e.preventDefault();return true}return false},DetailClick:function(e,a,h){return false},DetailContextmenu:function(e,a,h){return false},DetailCursor:function(e,h){if(h.m_Design){if(h.m_Hit==VBI.HTBOXHANDLE){var c=['nw-resize','n-resize','ne-resize','w-resize','','e-resize','sw-resize','s-resize','se-resize'];return c[h.m_Handle]}else if(h.m_Hit==VBI.HTBOX){return'move'}}return'pointer'},GetSelectColor:function(c,o){var r,a;if(a=this.m_SelectColor.GetValueString(c)){if(r=VBI.Types.string2rhls(a)){var b;if(b=VBI.Types.color2array(o)){var h=VBI.Utilities.RGB2HLS(b[0],b[1],b[2]);var d=VBI.Utilities.HLS2RGB(h[0]+r[0],h[1]*r[1],h[2]*r[2]);return'rgba('+Math.min(Math.round(d[0]),255)+","+Math.min(Math.round(d[1]),255)+","+Math.min(Math.round(d[2]),255)+","+Math.min((r[3]*b[3]).toString(),1.0)+')'}}else if(r=VBI.Types.string2color(a)){return r}}return o},GetHotColor:function(c,o){var r,a;if(a=this.m_HotDeltaColor.GetValueString(c)){if(r=VBI.Types.string2rhls(a)){var b;if(b=VBI.Types.color2array(o)){var h=VBI.Utilities.RGB2HLS(b[0],b[1],b[2]);var d=VBI.Utilities.HLS2RGB(h[0]+r[0],h[1]*r[1],h[2]*r[2]);return'rgba('+Math.min(Math.round(d[0]),255)+","+Math.min(Math.round(d[1]),255)+","+Math.min(Math.round(d[2]),255)+","+Math.min((r[3]*b[3]).toString(),1.0)+')'}}else if(r=VBI.Types.string2color(a)){return r}}return this.m_colorHot},GetHotScale:function(c){var r;if(r=this.m_HotScale.GetValueVector(c))return r;return[1.0,1.0,1.0]},RectSelect:function(s){var t,o,h=[];for(var n=this.m_BB.length-1;n>=0;--n){if(t=this.m_BB[n])for(var a=this.m_IO[n].length-1;a>=0;--a){var b=this.m_IO[n][a];o=[s[0]-b,s[1],s[2]-b,s[3]];if(t[0]>=o[0]&&t[1]>=o[1]&&t[2]<=o[2]&&t[3]<=o[3])h.push(n)}}return h}};VBI.VisualObjects.Spot=function(){this.m_fHotScale=1.2;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_Image=new VBI.AttributeProperty(d,'image',this.m_DataSource,c));this.m_Props.push(this.m_ImageSelected=new VBI.AttributeProperty(d,'imageSelected',this.m_DataSource,c,null));this.m_Props.push(this.m_Icon=new VBI.AttributeProperty(d,'icon',this.m_DataSource,c));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',this.m_DataSource,c));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.BaseLoad(d,c,this)};this.DetailHitTest=function(o,n,a,b){this.m_DataSource.Select(n);var c=o.m_Ctx;var i=this.m_Image.GetValueString(c);var h=this.IsHot(n,c);var s=this.IsSelected(c);var d,e=0;if(d=c.GetResources().GetImageBits(i,s?this.m_SelectColor.GetValueString(c):null,h?this.m_HotDeltaColor.GetValueString(c):null)){var f=d[0];var r=this.m_BB[n];var w=r[2]-r[0];var g=r[3]-r[1];var j=Math.floor((a-r[0])/w*d[1]);var k=Math.floor((b-r[1])/g*d[2]);e=f[(k*d[1]+j)*4+3]}return(e>0)?{m_hit:(e==255?1:2)}:null};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_Ctx:this.m_Scene.m_Ctx};return this.BaseHitTest(n,a,o)};this.RenderInstance=function(n,d,p,i,t,s,h){VBI.m_bTrace&&VBI.Trace("Spot: RenderInstance");if(!i)return;var a=this.m_Scene;var x=a.GetPointFromPos(p,true);var z=a.GetCurrentZoomFactors();var w=i.naturalWidth/z[0]*s[0];var b=i.naturalHeight/z[1]*s[1];if(h){var c=this.GetHotScale(a.m_Ctx);w=Math.round(w*c[0]);b=Math.round(b*c[1])}var l=x[0]-w/2;var e=x[1]-b;var I=this.m_IO[n]=a.GetInstanceOffsets(this.m_BB[n]=[l,e,l+w,e+b]);if(this.IsPosChangeable(a.m_Ctx)){var D=this.m_DH[n]=[];if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x)}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(this.m_BB[n])}}d.font=(Math.floor(b/2.8)).toString()+"px Arial";if(t){d.fillStyle="rgba( 0, 0, 0, 1.0 )";d.strokeStyle="rgba( 0, 0, 0, 1.0 )";d.textAlign="center"}for(var f=0;f<I.length;++f){var o=I[f];d.drawImage(i,l+o,e,w,b);if(t)d.fillText(t,l+o+w/2,e+b/2.2)}};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_DH=[];var s=this.m_Scene;var a=s.m_Ctx;var n,t;if(n=this.m_DataSource.GetCurrentNode(a)){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);var h=this.IsHot(b);var S=this.IsSelected(a);var i=this.m_Pos.GetValueVector(a);var e=this.m_Image.GetValueString(a);if(S&&(t=this.m_ImageSelected.GetValueString(a)))e=t;var f=this.m_Text.GetValueString(a);var g=this.m_Scale.GetValueVector(a);var j=a.GetResources().GetImage(e,S?this.m_SelectColor.GetValueString(a):null,h?this.m_HotDeltaColor.GetValueString(a):null,s.RenderAsync.bind(s));this.RenderInstance(b,d,i,j,f,g,h)}}else{}this.BaseRender(c,d)};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0)};this.DesignGetActiveBoxHandles=function(i){return[1,1,1,1,0,1,0,0,0]};this.DesignBoxSize=VBI.Utilities.SceneBindDesignSpotBoxSize.bind(this)};VBI.VisualObjects.Spot.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Route=function(){this.m_LP=[];this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'posarray',this.m_DataSource,c));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Start=new VBI.AttributeProperty(d,'start',this.m_DataSource,c,0));this.m_Props.push(this.m_End=new VBI.AttributeProperty(d,'end',this.m_DataSource,c,0));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_LineWidth=new VBI.AttributeProperty(d,'linewidth',this.m_DataSource,c,6.0));this.m_Props.push(this.m_DotColor=new VBI.AttributeProperty(d,'dotcolor',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_DotBorderColor=new VBI.AttributeProperty(d,'dotbordercolor',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_DotWidth=new VBI.AttributeProperty(d,'dotwidth',this.m_DataSource,c,0.0));this.BaseLoad(d,c,this)};this.DrawArrow=function(c,a,b){if(a.length<3)return;c.beginPath();c.moveTo(a[0][0],a[0][1]);c.lineTo(a[1][0],a[1][1]);c.lineTo(a[2][0],a[2][1]);c.lineTo(a[0][0],a[0][1]);c.closePath();c.fillStyle=b;c.fill()};this.CalcArrow=function(s,p,a,r,b){var n=p.length/3;var d=2*a*a;var c,e;var t,f,g,h,x=[0,0,0];var F=false;e=r?n-1:0;h=g=[p[e*3],p[e*3+1],0.0];for(c=1;c<n;c++){e=r?n-1-c:c;x=[p[e*3],p[e*3+1],0.0];if(((t=(h[0]-x[0]))*t+(f=(h[1]-x[1]))*f)>d){F=true;break}}if(!F)return false;var i=x[0]-g[0];var j=x[1]-g[1];while((Math.abs(i)>1000.0)&&(Math.abs(j)>1000.0)){i/=1000.0;j/=1000.0}var l=Math.sqrt(i*i+j*j);i=(i*a)/l;j=(j*a)/l;var k=g[0]+i;var m=g[1]+j;b.idx=r?n-c-1:c;b.ta=[[g[0],g[1]],[k+j,m-i],[k-j,m+i]];b.pt=[k,m];return true};this.RenderInstance=function(n,d,p,c,s,e,l,a,b,f){var g=this.m_Scene;var h=g.GetNearestPosArray(p);var i=g.GetPointFromPos([h.m_MinX,h.m_MaxY,0.0],false);var r=g.GetPointFromPos([h.m_MaxX,h.m_MinY,0.0],false);var j=Math.max(l,f/2);var I=this.m_IO[n]=g.GetInstanceOffsets(this.m_BB[n]=[i[0]-j,i[1]-j,r[0]+j,r[1]+j]);var k=I.length?g.GetPointArrayFromPosArray(h,false):null;for(var m=0,o=I.length;m<o;++m){d.setTransform(1,0,0,1,I[m],0);this.RenderRoute(n,d,k,c,s,e,l,a,b,f);VBI.m_bTrace&&VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n])}d.setTransform(1,0,0,1,0,0)};this.RenderRoute=function(n,d,p,c,s,e,l,a,b,f){var g=this.m_Scene;var h=l*l/2;var i=p.length/3;if(i<2)return;var t,j,k=1;var m=i-1;var L=this.m_LP[n];var H=this.m_DH[n];var D=f?[]:null;if(L.length)L=null;if(H&&H.length)H=null;if(H){if(H.m_EditMode==VBI.EMHandle){for(var o=0;o<i;++o)H.push([p[o*3],p[o*3+1]])}else if(H.m_EditMode==VBI.EMBox){H.push(this.m_BB[n])}}var r={};var q={};if(l&&s&&this.CalcArrow(g,p,l+5,false,r)){this.DrawArrow(d,r.ta,c);k=r.idx;if(L)L.m_RS=r}if(l&&e&&this.CalcArrow(g,p,l+5,true,q)){this.DrawArrow(d,q.ta,c);m=q.idx;if(L)L.m_RE=q}d.strokeStyle=c;d.lineWidth=l;d.lineCap='round';var u=r.pt?[r.pt[0],r.pt[1]]:[p[0],p[1],0.0];if(L)L.push(u);d.beginPath();d.moveTo(u[0],u[1]);for(var o=k;o<=m;++o){var x=[p[o*3],p[o*3+1],0.0];if(((t=(u[0]-x[0]))*t+(j=(u[1]-x[1]))*j)<h)continue;if(l)d.lineTo(x[0],x[1]);if(L)L.push(x);if(D)D.push(x);u=x}if(q.pt){if(l)d.lineTo(q.pt[0],q.pt[1]);if(L)L.push(q.pt)}d.stroke();if(D){d.fillStyle=a;d.strokeStyle=b;d.lineWidth=1;for(var o=0,w=D.length;o<w;++o){var x=D[o];d.beginPath();d.arc(x[0],x[1],f/2.0,0,2.0*Math.PI);d.closePath();d.fill();d.stroke()}}};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_LP=[];this.m_DH=[];var a=this.m_Scene.m_Ctx;var n;if(n=this.m_DataSource.GetCurrentNode(a)){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);this.m_LP[b]=[];if(this.IsPosChangeable(a)){var D=(this.m_DH[b]=[]);if(this.IsHandleMode())D.m_EditMode=VBI.EMHandle;else if(this.IsBoxMode())D.m_EditMode=VBI.EMBox}var h=this.IsHot(b);var s=this.IsSelected(a);var p=this.m_Pos.GetValueVector(a);var e=this.m_Color.GetValueColor(a);if(s)e=this.GetSelectColor(a,e);if(h)e=this.GetHotColor(a,e);var f=this.m_Start.GetValueLong(a);var g=this.m_End.GetValueLong(a);var i=this.m_LineWidth.GetValueFloat(a);if(h)i*=(this.GetHotScale(a))[0];var j=this.m_DotColor.GetValueColor(a);if(s)j=this.GetSelectColor(a,e);if(h)j=this.GetHotColor(a,j);var k=this.m_DotBorderColor.GetValueColor(a);if(s)k=this.GetSelectColor(a,e);if(h)k=this.GetHotColor(a,k);var m=this.m_DotWidth.GetValueFloat(a);this.RenderInstance(b,d,p,e,f,g,i,j,k,m)}}else{}this.BaseRender(c,d)};this.DetailHitDot=function(n,a,x,y,s){var t,b;return(((t=(x-n))*t+(b=(y-a))*b)<s)?true:false};this.DetailHitTest=function(o,n,a,b){var x,y,c,d;this.m_DataSource.Select(n);var l=this.m_LineWidth.GetValueLong(this.m_Scene.m_Ctx)/2;var e=this.m_DotWidth.GetValueLong(this.m_Scene.m_Ctx)/2;var s=l*l;var f=e*e;var L=this.m_LP[n];x=L[0][0];y=L[0][1];if(f&&this.DetailHitDot(a,b,x,y,f))return{m_hit:1,m_dot:0};var g=L.length;for(var h=1;h<g;++h){c=L[h][0];d=L[h][1];if(l&&!((a<(Math.min(x,c)-l))||(a>(Math.max(x,c)+l))||(b<(Math.min(y,d)-l))||(b>(Math.max(y,d)+l)))&&(s>VBI.Utilities.sqDistance(x,y,c,d,a,b))){VBI.m_bTrace&&VBI.Trace("VBI.VisualObjects.Route hit line "+n);return{m_hit:1}}if(f&&this.DetailHitDot(a,b,c,d,f)){VBI.m_bTrace&&VBI.Trace("VBI.VisualObjects.Route hit dot "+n);return{m_hit:1,m_dot:h}}x=c;y=d}if(L.m_RS&&VBI.Utilities.pointInTriangle(L.m_RS.ta,[a,b]))return{m_hit:1,m_arrow:0};if(L.m_RE&&VBI.Utilities.pointInTriangle(L.m_RE.ta,[a,b]))return{m_hit:1,m_arrow:1};return null};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this)};return this.BaseHitTest(n,a,o)};this.DesignBoxSize=VBI.Utilities.SceneBindPosArrayDesignBoxSize.bind(this)};VBI.VisualObjects.Route.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Circle=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(d,'radius',this.m_DataSource,c,5));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Slices=new VBI.AttributeProperty(d,'slices',this.m_DataSource,c,10));this.BaseLoad(d,c,this)};this.RenderInstance=function(n,d,p,c,a,b,s){var e=this.m_Scene;var z=e.GetCurrentZoomFactors();var r=b/z[0];var x=e.GetPointFromPos(p,false);var f;var i=this.m_IO[n]=e.GetInstanceOffsets(f=this.m_BB[n]=[x[0]-r,x[1]-r,x[0]+r,x[1]+r]);f.m_Radius=r;f.m_Pos=x;if(this.IsPosChangeable(e.m_Ctx)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x)}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(f)}}d.lineWidth=1;d.fillStyle=c;for(var g=0;g<i.length;++g){d.setTransform(1,0,0,1,i[g],0);d.beginPath();d.arc(x[0],x[1],r,0,2*Math.PI);d.closePath();d.fill();d.strokeStyle=a;d.stroke();VBI.m_bTrace&&VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n])}d.setTransform(1,0,0,1,0,0)};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_DH=[];var a=this.m_Scene.m_Ctx;var n;if(n=this.m_DataSource.GetCurrentNode(a)){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);var h=this.IsHot(b);var S=this.IsSelected(a);var p=this.m_Pos.GetValueVector(a);var e=this.m_Color.GetValueColor(a);if(S)e=this.GetSelectColor(a,e);if(h)e=this.GetHotColor(a,e);var f=this.m_ColorBorder.GetValueColor(a);if(S)f=this.GetSelectColor(a,f);if(h)f=this.GetHotColor(a,f);var r=this.m_Radius.GetValueFloat(a);if(h)r=(this.GetHotScale(a))[0]*r;var s=this.m_Slices.GetValueLong(a);this.RenderInstance(b,d,p,e,f,r,s)}}else{}this.BaseRender(c,d)};this.DetailHitTest=function(o,n,a,b){var c=this.m_BB[n];var r=c.m_Radius;var x=c.m_Pos;var t,d;if(((t=(x[0]-a))*t+(d=(x[1]-b))*d)<r*r)return{m_hit:1};return null};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_zf:z};return this.BaseHitTest(n,a,o)};this.DesignGetActiveBoxHandles=function(i){var s=this.m_Scene;this.m_DataSource.Select(i);return this.m_Radius.IsChangeable(s.m_Ctx)?[0,1,0,1,0,1,0,1,0]:[0,0,0,0,0,0,0,0,0]};this.DesignBoxSize=VBI.Utilities.SceneBindRadiusDesignBoxSize.bind(this)};VBI.VisualObjects.Circle.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.CircleDist=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'midpoint',this.m_DataSource,c));this.m_Props.push(this.m_ColBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(d,'radius',this.m_DataSource,c,10));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_ColFill=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Slices=new VBI.AttributeProperty(d,'slices',this.m_DataSource,c,10));this.BaseLoad(d,c,this)};this.RenderCircleDist=function(n,d,a,c,b){var s=this.m_Scene;var l=this.m_LP[n];if(l.length)l=null;var t,e,x,f=s.GetPointFromGeo(a[0],false);d.strokeStyle=b;d.fillStyle=c;d.lineWidth=1;d.beginPath();d.moveTo(f[0],f[1]);l&&l.push(f);for(var g=1;g<a.length;++g){x=s.GetPointFromGeo(a[g],false);if(((t=(f[0]-x[0]))*t+(e=(f[1]-x[1]))*e)<5.0)continue;l&&l.push(x);d.lineTo(x[0],x[1]);f=x}d.closePath();d.stroke();d.fill()};this.RenderInstance=function(n,d,p,c,a,r,s){var b,e=this.m_Scene;var f=VBI.MathLib.EquidistantLonLat(VBI.MathLib.DegToRad(p),r,s);this.m_Pos.IsChangeable(e.m_Ctx)&&(this.m_DH[n]=[e.GetPointFromPos(p,false)]);var l=e.GetPointFromGeo([f.m_MinX,f.m_MaxY,0.0],false);var g=e.GetPointFromGeo([f.m_MaxX,f.m_MinY,0.0],false);var i=this.m_IO[n]=e.GetInstanceOffsets(b=this.m_BB[n]=[l[0],l[1],g[0],g[1]]);if(this.IsPosChangeable(e.m_Ctx)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(e.GetPointFromPos(p,false))}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(b)}}for(var h=0;h<i.length;++h){d.setTransform(1,0,0,1,i[h],0);this.RenderCircleDist(n,d,f,c,a);VBI.m_bTrace&&VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n])}d.setTransform(1,0,0,1,0,0)};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_LP=[];this.m_DH=[];var a=this.m_Scene.m_Ctx;var n;if(n=this.m_DataSource.GetCurrentNode(a)){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);var h=this.IsHot(b);var S=this.IsSelected(a);var p=this.m_Pos.GetValueVector(a);var e=this.m_ColBorder.GetValueColor(a);if(S)e=this.GetSelectColor(a,e);if(h)e=this.GetHotColor(a,e);var r=this.m_Radius.GetValueFloat(a);if(h)r=(this.GetHotScale(a))[0]*r;var s=this.m_Slices.GetValueLong(a);var f=this.m_ColFill.GetValueColor(a);if(S)f=this.GetSelectColor(a,f);if(h)f=this.GetHotColor(a,f);this.m_LP[b]=[];this.RenderInstance(b,d,p,f,e,r,s)}}else{}this.BaseRender(c,d)};this.DetailHitTest=function(o,n,a,b){return VBI.Utilities.pointInPolygon(this.m_LP[n],a,b)?{m_hit:1}:null};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_zf:z};return this.BaseHitTest(n,a,o)};this.DesignGetActiveBoxHandles=function(i){var s=this.m_Scene;this.m_DataSource.Select(i);return this.m_Radius.IsChangeable(s.m_Ctx)?[0,1,0,1,0,1,0,1,0]:[0,0,0,0,0,0,0,0,0]};this.DesignBoxSize=VBI.Utilities.SceneBindMeterRadiusDesignBoxSize.bind(this)};VBI.VisualObjects.CircleDist.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.m_AC=["rgba(0,143,211,1.0)","rgba(153,209,1,1.0)","rgba(243,155,2,1.0)","rgba(159,207,236,1.0)","rgba(75,167,7,1.0)","rgba(246,209,51,1.0)","rgba(203,77,44,1.0)","rgba(202,199,186,1.0)","rgba(13,134,156,1.0)","rgba(205,215,46,1.0)","rgba(36,114,48,1.0)","rgba(108,222,220,1.0)","rgba(235,115,0,1.0)","rgba(185,187,209,1.0)","rgba(0,109,211,1.0)","rgba(61,185,127,1.0)","rgba(165,84,148,1.0)","rgba(1,88,43,1.0)","rgba(77,182,239,1.0)","rgba(175,43,23,1.0)","rgba(212,153,18,1.0)","rgba(187,204,210,1.0)","rgba(48,146,13,1.0)","rgba(29,169,193,1.0)","rgba(42,71,201,1.0)","rgba(209,153,194,1.0)","rgba(204,88,38,1.0)","rgba(114,191,68,1.0)","rgba(10,72,157,1.0)","rgba(151,156,163,1.0)","rgba(14,145,144,1.0)","rgba(97,32,154,1.0)"];VBI.VisualObjects.Pie=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Series=new VBI.NodeProperty(d,'series',this.m_DataSource,c));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_Values=new VBI.AttributeProperty(d,'value',this.m_Series,c));this.m_Props.push(this.m_Texts=new VBI.AttributeProperty(d,'text',this.m_Series,c));this.m_Props.push(this.m_Tooltips=new VBI.AttributeProperty(d,'tooltip',this.m_Series,c,this.m_defaultTooltip));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.BaseLoad(d,c,this)};this.RenderInstance=function(n,d,p,r,a,t,b,h,s){var c=this.m_Scene;var e=c.m_Ctx;var f=0;for(var g=0;g<a.length;++g)f+=a[g];var x=c.GetPointFromPos(p,false);var z=c.GetCurrentZoomFactors();r/=z[0];var i;var I=this.m_IO[n]=c.GetInstanceOffsets(i=this.m_BB[n]=[x[0]-r,x[1]-r,x[0]+r,x[1]+r]);i.m_Radius=r;i.m_Pos=x;if(this.IsPosChangeable(e)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x)}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(i)}}for(var j=0;j<I.length;++j){d.setTransform(1,0,0,1,I[j],0);var l=3*Math.PI/2;for(var g=0;g<a.length;++g){var k=d.createRadialGradient(x[0],x[1],0,x[0],x[1],r);var m=VBI.VisualObjects.m_AC[g%VBI.VisualObjects.m_AC.length];if(s)m=this.GetSelectColor(e,m);if(h)m=this.GetHotColor(e,m);k.addColorStop(0,m);k.addColorStop(0.95,m);k.addColorStop(1.0,'rgba(255,255,255,0.0 )');d.fillStyle=k;d.beginPath();d.moveTo(x[0],x[1]);var o=Math.PI*2*(a[g]/f);d.arc(x[0],x[1],r,l,l+o,false);d.lineTo(x[0],x[1]);d.closePath();d.fill();l+=o}}d.setTransform(1,0,0,1,0,0)};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_DH=[];var s=this.m_Scene;var a=s.m_Ctx;var n,b;if(n=this.m_DataSource.GetCurrentNode(a)){for(var e=0,l=n.m_dataelements.length;e<l;++e){this.m_DataSource.Select(e);var p=this.m_Pos.GetValueVector(a);var S=this.m_Scale.GetValueVector(a);var r=16*S[0];var h=this.IsHot(e);var f=this.IsSelected(a);if(h)r=(this.GetHotScale(a))[0]*r;var V=[],t=[],T=[];if(b=this.m_Series.GetCurrentNode(a)){for(var g=0;g<b.m_dataelements.length;++g){this.m_Series.Select(g);V.push(this.m_Values.GetValueFloat(a));t.push(this.m_Texts.GetValueString(a));T.push(this.m_Tooltips.GetValueString(a))}}this.RenderInstance(e,d,p,r,V,t,T,h,f)}}else{}this.BaseRender(c,d)};this.DetailHitTest=function(o,n,a,b){var c=this.m_BB[n];var r=c.m_Radius;var p=c.m_Pos;var t,d;if(((t=(p[0]-a))*t+(d=(p[1]-b))*d)<(r*r))return{m_hit:1};return null};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this)};return this.BaseHitTest(n,a,o)};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0)};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,true)};VBI.VisualObjects.Pie.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Box=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c,[0.0,0.0,0.0]));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.BaseLoad(d,c,this)};this.RenderInstance=function(n,d,p,s,c,a,e){var g,h=this.m_Scene;if(!s)s=[1.0,1.0,1.0];if(!c)c="#6f6f7a";var x=h.GetPointFromPos(p,false);var z=h.GetCurrentZoomFactors();var i=1.0;sy=1.0;if(this.IsHot(n)){var j=this.GetHotScale(h.m_Ctx);i=j[0];sy=j[1]}var k=512;var m=k*s[0]*i/z[0];var o=k*s[1]*sy/z[1];if(!e){var f=Math.pow(2,h.GetCurrentZoomlevel())/20;m*=f;o*=f}var l=x[0]-m/2;var t=x[1]-o/2;var r=x[0]+m/2;var b=x[1]+o/2;var I=this.m_IO[n]=h.GetInstanceOffsets(g=this.m_BB[n]=[l,t,r,b]);if(this.IsPosChangeable(h.m_Ctx)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x)}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(g)}}for(var q=0;q<I.length;++q){d.setTransform(1,0,0,1,I[q],0);d.fillStyle=c;d.fillRect(l,t,m,o);d.lineWidth=1;d.strokeStyle=a;d.strokeRect(l,t,m,o);VBI.m_bTrace&&VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n])}d.setTransform(1,0,0,1,0,0)};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_DH=[];var s=this.m_Scene,a=s.m_Ctx;var n;if(n=this.m_DataSource.GetCurrentNode(a)){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);var h=this.IsHot(b);var S=this.IsSelected(a);var p=this.m_Pos.GetValueVector(a);var e=this.m_Scale.GetValueVector(a);var C=this.m_Color.GetValueColor(a);if(S)C=this.GetSelectColor(a,C);if(h)C=this.GetHotColor(a,C);var f=this.m_ColorBorder.GetValueColor(a);if(S)f=this.GetSelectColor(a,f);if(h)f=this.GetHotColor(a,f);var F=this.m_FxSize.GetValueBool(a);this.RenderInstance(b,d,p,e,C,f,F)}}else{}this.BaseRender(c,d)};this.DetailHitTest=function(o,n,a,b){return{m_hit:1}};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this)};return this.BaseHitTest(n,a,o)};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0)};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,false)};VBI.VisualObjects.Box.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Area=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'posarray',this.m_DataSource,c));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.BaseLoad(d,c,this)};this.RenderInstance=function(n,d,p,c,a,l,h){var s=this.m_Scene;var b=s.GetNearestPosArray(p);var e=s.GetPointFromPos([b.m_MinX,b.m_MaxY,0.0],false);var r=s.GetPointFromPos([b.m_MaxX,b.m_MinY,0.0],false);var i=this.m_IO[n]=s.GetInstanceOffsets(this.m_BB[n]=[e[0]-l,e[1]-l,r[0]+l,r[1]+l]);var f=i.length?s.GetPointArrayFromPosArray(b,false):null;if(this.IsPosChangeable(s.m_Ctx)&&f){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;for(var g=0,j=f.length/3;g<j;++g)D.push([f[g*3],f[g*3+1]])}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(this.m_BB[n])}}for(var g=0;g<i.length;++g){d.setTransform(1,0,0,1,i[g],0);this.RenderArea(n,d,f,c,a,l,h);VBI.m_bTrace&&VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n])}d.setTransform(1,0,0,1,0,0)};this.RenderArea=function(n,d,p,c,a,l,h){var s=l*l/2;var i,x,t,b;var e=p.length/3;if(e<2)return;var L=this.m_LP[n];if(L.length)L=null;d.strokeStyle=a;d.fillStyle=c;d.lineWidth=h>0?3:l;d.lineCap='round';d.beginPath();var f=[p[0],p[1]];if(L)L.push(f);d.moveTo(f[0],f[1]);for(var g=1;g<e;++g){i=g*3;x=[p[i],p[i+1],0.0];if(((t=(f[0]-x[0]))*t+(b=(f[1]-x[1]))*b)<s)continue;d.lineTo(x[0],x[1]);if(L)L.push(x);f=x}d.closePath();d.fill();d.stroke()};this.Render=function(c,d){this.m_BB=[];this.m_IO=[];this.m_LP=[];this.m_DH=[];var s=this.m_Scene;var a=s.m_Ctx;var n;if(n=this.m_DataSource.GetCurrentNode(a)){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);this.m_LP[b]=[];var h=this.IsHot(b);var S=this.IsSelected(a);var e=-1;var p=this.m_Pos.GetValueVector(a);var f=this.m_Color.GetValueColor(a);if(S)f=this.GetSelectColor(a,f);var g=this.m_ColorBorder.GetValueColor(a);if(S)g=this.GetSelectColor(a,g);if(h){var i=s.m_HotItem.m_HitObj.m_Detail;if(i&&(e=i.m_edge)>=0)g=this.GetHotColor(a,g);else f=this.GetHotColor(a,f)}this.RenderInstance(b,d,p,f,g,this.m_LineWidth,e)}}else{}this.BaseRender(c,d)};this.DetailHitTest=function(o,n,a,b){if(VBI.Utilities.pointInPolygon(this.m_LP[n],a,b)){var h={m_hit:1};var e;if((e=VBI.Utilities.pointOnLine(this.m_LP[n],a,b,5,true))>=0)h.m_edge=e;return h}return null};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this)};return this.BaseHitTest(n,a,o)};this.ProcessDetailEdgeEvent=function(e,a,h,n){var b,s=this.m_Scene;if(b=s.m_Ctx.m_Actions){var c;if(c=b.findAction(n,s,this)){var p=s.GetEventVPCoordsObj(e);p.edge=h.m_Detail.m_edge.toString();this.m_Scene.m_Ctx.FireAction(c,s,this,a,p);return true}}return false};this.DetailClick=function(e,a,h){if(h.m_Detail&&(h.m_Detail.m_edge>=0))return this.ProcessDetailEdgeEvent(e,a,h,'EdgeClick');return false};this.DetailContextmenu=function(e,a,h){if(h.m_Detail&&(h.m_Detail.m_edge>=0))return this.ProcessDetailEdgeEvent(e,a,h,'EdgeContextMenu');return false};this.DesignBoxSize=VBI.Utilities.SceneBindPosArrayDesignBoxSize.bind(this)};VBI.VisualObjects.Area.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Base2D=function(){this.m_DOMElement=null;this.m_paddingLeft=5;this.m_paddingTop=5;this.m_paddingRight=5;this.m_paddingBottom=5;this.IsValid=function(){if(this.m_DOMElement&&this.m_Scene.m_Div){if(this.m_DOMElement.parentNode==this.m_Scene.m_Div)return true}return false};this.load=function(i,d,c){Object.getPrototypeOf(this).load(this,d,c);i.m_Props.push(i.m_Left=new VBI.AttributeProperty(d,'left',null,c));i.m_Props.push(i.m_Top=new VBI.AttributeProperty(d,'top',null,c));i.m_Props.push(i.m_Right=new VBI.AttributeProperty(d,'right',null,c));i.m_Props.push(i.m_Bottom=new VBI.AttributeProperty(d,'bottom',null,c));i.m_Props.push(i.m_Align=new VBI.AttributeProperty(d,'align',null,c,1))};this.clear=function(){Object.getPrototypeOf(this).clear();this.m_DOMElement=null};this.BaseClick=function(e){var s=this.m_Scene;var a;if(a=s.m_Ctx.m_Actions){var b;if(b=a.findAction("Click",s,this)){s.m_Ctx.FireAction(b,s,this,null,s.GetEventVPCoordsObj(e));e.preventDefault();return true}}return false}};VBI.VisualObjects.Base2D.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Caption=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""));this.m_Props.push(this.m_Design=new VBI.AttributeProperty(d,'design',null,c,"0"));this.m_Props.push(this.m_Level=new VBI.AttributeProperty(d,'level',null,c,0));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""))};this.Render=function(c,d){if(this.IsValid())return;var a=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(a);var t=this.m_Top.GetValueLong(a);var r=this.m_Right.GetValueLong(a);var b=this.m_Bottom.GetValueLong(a);var e=this.m_Align.GetValueLong(a);var f=this.m_Text.GetValueString(a);var g=this.m_Design.GetValueLong(a);var h=this.m_Level.GetValueLong(a);var i=this.m_Tooltip.GetValueString(a);this.m_DOMElement=VBI.Utilities.CreateCaption(this.m_ID,f,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,i,g,h,e);this.m_Scene.m_Div.appendChild(this.m_DOMElement)}};VBI.VisualObjects.Caption.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Label=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""));this.m_Props.push(this.m_Design=new VBI.AttributeProperty(d,'design',null,c,"0"))};this.Render=function(c,d){if(this.IsValid())return;var a=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(a);var t=this.m_Top.GetValueLong(a);var r=this.m_Right.GetValueLong(a);var e=this.m_Align.GetValueLong(a);var b=this.m_Bottom.GetValueLong(a);var f=this.m_Text.GetValueString(a);this.m_DOMElement=VBI.Utilities.CreateLabel(this.m_ID,f,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,0,e);this.m_Scene.m_Div.appendChild(this.m_DOMElement)}};VBI.VisualObjects.Label.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Link=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Reference=new VBI.AttributeProperty(d,'reference',null,""));this.m_Props.push(this.m_Autoexecute=new VBI.AttributeProperty(d,'autoexecute',null,c,false));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""))};this.clear=function(){if(this.m_DOMElement)this.m_DOMElement.onclick=null;Object.getPrototypeOf(this).clear()};this.Render=function(c,d){if(this.IsValid())return;var a=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(a);var t=this.m_Top.GetValueLong(a);var r=this.m_Right.GetValueLong(a);var b=this.m_Bottom.GetValueLong(a);var e=this.m_Align.GetValueLong(a);var f=this.m_Text.GetValueString(a);var g=this.m_Reference.GetValueString(a);var h=this.m_Autoexecute.GetValueBool(a);var i=this.m_Tooltip.GetValueString(a);this.m_DOMElement=VBI.Utilities.CreateLink(this.m_ID,f,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,h?g:null,i,e);this.m_Scene.m_Div.appendChild(this.m_DOMElement);this.m_DOMElement.onclick=this.onclick.bind(this)};this.onclick=function(e){return this.BaseClick(e)}};VBI.VisualObjects.Link.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Image=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Image=new VBI.AttributeProperty(d,'image',null,c));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""))};this.Render=function(c,d){if(this.IsValid())return;var a=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(a);var t=this.m_Top.GetValueLong(a);var r=this.m_Right.GetValueLong(a);var b=this.m_Bottom.GetValueLong(a);var e=this.m_Align.GetValueLong(a);var i=this.m_Image.GetValueString(a);var f=this.m_Tooltip.GetValueString(a);var g;if(g=a.GetResources().GetImage(i)){this.m_DOMElement=VBI.Utilities.CreateImage(this.m_ID,g,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,f,e);this.m_Scene.m_Div.appendChild(this.m_DOMElement)}}};VBI.VisualObjects.Image.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.Button=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""))};this.clear=function(){if(this.m_DOMElement)this.m_DOMElement.onclick=null;Object.getPrototypeOf(this).clear()};this.Render=function(c,d){if(this.IsValid())return;var a=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(a);var t=this.m_Top.GetValueLong(a);var r=this.m_Right.GetValueLong(a);var b=this.m_Bottom.GetValueLong(a);var e=this.m_Text.GetValueString(a);var f=this.m_Tooltip.GetValueString(a);this.m_DOMElement=VBI.Utilities.CreateButton(this.m_ID,e,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,f);this.m_Scene.m_Div.appendChild(this.m_DOMElement);this.m_DOMElement.onclick=this.onclick.bind(this)};this.onclick=function(e){return this.BaseClick(e)}};VBI.VisualObjects.Button.prototype=new VBI.VisualObjects.Base2D;VBI.VisualObjects.DetailWindowProxy=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c))};this.DetailHitTest=function(o,n,a,b){return{m_hit:1}};this.GetHitArray=function(x,y){var z=this.m_Scene.GetCurrentZoomFactors();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_Ctx:this.m_Scene.m_Ctx};return this.BaseHitTest(n,a,o)};this.Render=function(c,d){var s=this.m_Scene;var x=s.GetPointFromPos(pos,true);this.IsPosChangeable(s.m_Ctx)&&this.IsHandleMode()&&(this.m_DH[nIndex]=[x]);this.BaseRender(c,d)}};VBI.VisualObjects.DetailWindowProxy.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Dummy=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c)};this.RenderInstance=function(n,d,x,s,c){};this.Render=function(c,d){this.BaseRender(c,d)}};VBI.VisualObjects.Dummy.prototype=VBI.VisualObjects.Base;return v};
