 
VBI.Windows=function(){var w={};w.vbiclass="Windows";w.m_WindowArray=[];w.find=function(n){for(var a=0,l=w.m_WindowArray.length;a<l;++a)if(w.m_WindowArray[a].m_ID==n)return w.m_WindowArray[a];return null};w.clear=function(){for(var n=0;n<w.m_WindowArray.length;++n)w.m_WindowArray[n].clear();w.m_WindowArray=[]};w.load=function(d,c){if(d.Remove){if(jQuery.type(d.Remove)=='object'){if(d.Remove.name)w.Remove(d.Remove.name)}else if(jQuery.type(d.Remove)=='array'){for(var n=0,l=d.Remove.length;n<l;++n){if(d.Remove[n].name)w.Remove(d.Remove[n].name)}}}if(d.Set){if(jQuery.type(d.Set)=='object'){var a;if(d.Set.name){if(a=w.find(d.Set.name)){a.load(d.Set.Window,c);return}else{if(d.Set.Window.type=="callout")a=new VBI.CalloutWindow();else a=new VBI.Window();a.load(d.Set.Window,c);w.Add(a);return}}w.clear();if(d.Set.Window){if(jQuery.type(d.Set.Window)=='object'){a=new VBI.Window();a.load(d.Set.Window,c);w.Add(a)}}}else if(jQuery.type(d.Set)=='array'){}}};w.Add=function(a){w.m_WindowArray.push(a)};w.Remove=function(n){var a=null;for(var b=0,l=w.m_WindowArray.length;b<l;++b){if((a=w.m_WindowArray[b]).m_ID==n){a.clear();w.m_WindowArray.splice(b,1);break}}};w.Awake=function(t){for(var n=0;n<w.m_WindowArray.length;++n)w.m_WindowArray[n].Awake(t)};w.GetMainWindow=function(){for(var n=0;n<w.m_WindowArray.length;++n){if(w.m_WindowArray[n].m_refParent==null)return w.m_WindowArray[n]}return null};w.NotifyDataChange=function(){var a=w.m_WindowArray;for(var n=0;n<a.length;++n)a[n].NotifyDataChange();return null};w.NotifySceneMove=function(s){var a=w.m_WindowArray;for(var n=0,l=a.length;n<l;++n)a[n].NotifySceneMove(s);return null};w.NotifySceneZoom=function(s){var a=w.m_WindowArray;for(var n=0,l=a.length;n<l;++n)a[n].NotifySceneZoom(s);return null};w.Render=function(){var a=w.m_WindowArray;for(var n=0;n<a.length;++n)a[n].Render();return null};return w};
VBI.Window=function(){this.vbiclass="Window";this.m_ID="";this.m_Caption="";this.m_Type="";this.m_bModal=true;this.m_refScene=null;this.m_refParent=null;this.m_Width=null;this.m_Height=null;this.m_Div=null;this.m_Ctx=null;this.BaseLoad=function(i,d,c){if(d.id)i.m_ID=d.id;if(d.caption)i.m_Caption=d.caption;if(d.refParent)i.m_refParent=d.refParent;if(d.modal)i.m_bModal=(d.ref=="true")?true:false;if(d.width)i.m_Width=parseInt(d.width);if(d.height)i.m_Height=parseInt(d.height);i.m_Ctx=c;if(d.refScene)i.m_refScene=c.m_SceneManager.GetSceneByName(d.refScene);else VBI.m_bTrace&&VBI.Trace("Error: no scene assigned to window")};this.BaseClear=function(){this.m_refParent=null;this.m_refScene=null;this.m_Ctx=null;this.m_Div=null};this.clear=function(){this.BaseClear()};this.load=function(d,c){this.BaseLoad(this,d,c)};this.GetScene=function(){return this.m_refScene};this.GetHostingScene=function(){if(!this.m_refParent)return null;var w;if(w=this.m_Ctx.m_Windows.find(this.m_refParent))return w.m_refScene;return null};this.NotifyDataChange=function(){if(this.m_refScene)this.m_refScene.NotifyDataChange()};this.NotifySceneMove=function(s){return};this.NotifySceneZoom=function(s){return};this.Render=function(){if(this.m_refScene)this.m_refScene.Render()};this.Awake=function(t){if(this.m_refScene)this.m_refScene.Awake(t);else VBI.m_bTrace&&VBI.Trace("Error: Awake no scene assigned to window")};this.Create=function(t){};this.Destroy=function(){if(this.m_Div){}}};
VBI.CalloutWindow=function(){var c=new VBI.Window();c.m_oCallout=null;c.load=function(d,a){c.BaseLoad(c,d,a);c.m_Pos=new VBI.AttributeProperty(d,'pos',null,a);c.m_OffsetX=new VBI.AttributeProperty(d,'offsetX',null,a,0);c.m_OffsetY=new VBI.AttributeProperty(d,'offsetY',null,a,0)};c.clear=function(){c.UnRegisterEvents();c.Remove();c.BaseClear();c.m_oCallout=null};c.processclosebuttonclick=function(e){c.m_Ctx.onCloseWindow(c.m_ID,c.m_oCallout.m_Content);c.clear();e.preventDefault();e.stopPropagation()};c.IsValid=function(){return(c.m_oCallout&&c.m_oCallout.m_Div)?true:false};c.NotifySceneMove=function(s){c.UpdatePosition()};c.NotifySceneZoom=function(s){c.UpdatePosition()};c.CalcDivPosition=function(){if(!c.IsValid())return;var p=VBI.m_bIsPhone;if(p){return}var o=c.m_OffsetX.GetValueLong();var a=c.m_OffsetY.GetValueLong();var b=c.m_Pos.GetValueVector(c.m_Ctx);var h=c.GetHostingScene();var d=h.m_Canvas[h.m_nOverlayIndex];var e=d.getPixelLeft();var f=d.getPixelTop();var t=h.GetPointFromPos(b,true);var O=h.GetInstanceOffsets([t[0],t[1],t[0],t[1]]);for(var n=0,l=O.length;n<l;++n){var z=h.m_ZoomFactors[0]*O[n];if((t[0]+e+z)>0){t[0]+=z;break}}var d=h.m_Canvas[h.m_nOverlayIndex];t[0]+=e;t[1]+=f;t[0]+=o;t[1]+=a;var s=window.getComputedStyle(c.m_oCallout.m_Div);var g=c.m_oCallout.GetAnchorPoint();t[0]-=g[0];t[1]-=g[1];return t};c.UpdatePosition=function(){if(!c.IsValid())return;var p=c.CalcDivPosition();if(p){c.m_oCallout.m_Div.style.left=Math.round(p[0])+"px";c.m_oCallout.m_Div.style.top=Math.round(p[1])+"px"}else{c.m_oCallout.m_Div.style.top="";c.m_oCallout.m_Div.style.left="0px";c.m_oCallout.m_Div.style.bottom="0px"}};c.Create=function(t){if(c.m_refParent&&!c.m_oCallout){var h;if(h=c.GetHostingScene()){c.m_oCallout=VBI.Utilities.CreateDetail(t+"-"+c.m_ID,0,0,c.m_Width,c.m_Height,c.m_Caption,5,5);c.RegisterEvents();h.m_Div.appendChild(c.m_oCallout.m_Div);c.m_Ctx.onOpenWindow(c.m_ID,c.m_oCallout.m_Content);c.UpdatePosition()}}};c.RegisterEvents=function(){var f=c.processclosebuttonclick.bind(c);c.m_oCallout.m_CloseButton.onclick=f;c.m_oCallout.m_CloseButton.ontouchend=f};c.UnRegisterEvents=function(){if(!c.m_oCallout||!c.m_oCallout.m_CloseButton)return;c.m_oCallout.m_CloseButton.onclick=null;c.m_oCallout.m_CloseButton.ontouchend=null};c.Remove=function(){var a=c.m_oCallout;if(!a||!a.m_Div)return;var b=a.m_Div;while(b.firstChild)b.removeChild(b.firstChild);b.parentElement.removeChild(b);c.m_oCallout=null};c.Awake=function(t){if(this.m_refParent)this.Create(t);if(this.m_refScene){this.m_refScene.m_Div=c.m_oCallout.m_Content;this.m_refScene.Awake(t)}else VBI.m_bTrace&&VBI.Trace("Error: Awake no scene assigned to window")};return c};
