/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/model/TreeBinding','sap/ui/model/ChangeReason','sap/ui/model/Sorter','sap/ui/model/FilterOperator','sap/ui/thirdparty/odata4analytics'],function(q,T,C,S,F,o){"use strict";var A=T.extend("sap.ui.model.analytics.AnalyticalBinding",{constructor:function(m,p,c,s,f,P){T.call(this,m,p,c,f,P);this.aGlobalFilter=f;this.aGlobalSorter=s;this.aMaxAggregationLevel=[];this.aAggregationLevel=[];this.oPendingRequests={};this.oGroupedRequests={};this.bUseBatchRequests=(P&&P.useBatchRequests===true)?true:false;this.aRequestQueue=[];this.iTotalSize=-1;this.mFinalLength={};this.mLength={};this.mKey={};this.bNeedsUpdate=false;this.oAnalyticalQueryResult=this.oModel.getAnalyticalExtensions().findQueryResultByName(this._getEntitySetFromPath());this.aAnalyticalInfo=[];this.mAnalyticalInfoByProperty={};this.updateAnalyticalInfo(P==undefined?[]:P.analyticalInfo)}});A.prototype.getRootContexts=function(p){if(p&&p.numberOfExpandedLevels&&p.numberOfExpandedLevels!=0&&p.numberOfExpandedLevels!=1)q.sap.log.fatal("not implemented: number of initially expanded levels may be 0 or 1, but not "+p.numberOfExpandedLevels);var e=1;if(p&&p.numberOfExpandedLevels)e=p.numberOfExpandedLevels==1;var r=this._getContextsForParentContext(null);if(e){this._considerRequestGrouping([this._getRequestIdForGroupMembersQuery(null),this._getRequestIdForGroupMembersQuery("/")]);this.getNodeContexts(this.getModel().getContext("/"),{startIndex:0,iLength:40,iThreshold:100,iLevel:1})}if(r.length>1)q.sap.log.fatal("assertion failed: grand total represented by a single entry");return r};A.prototype.getNodeContexts=function(c,p){var s,l,t,L;if(typeof p=="object"){s=p.startIndex;l=p.length;t=p.threshold;L=p.level}else{s=arguments[1];l=arguments[2];t=arguments[3];L=arguments[4]}return this._getContextsForParentContext(c,s,l,t,L)};A.prototype.getGroupSize=function(c,l){if(c===undefined)return 0;var g=this._getGroupIdFromContext(c,l);return this.mFinalLength[g]?this.mLength[g]:-1};A.prototype.getTotalSize=function(){return this.iTotalSize};A.prototype.hasChildren=function(c,p){if(c===undefined)return false;if(c==null)return true;var i=p.level;if(i==0)return true;if(this.aAggregationLevel.length<i)return false;return this.aMaxAggregationLevel.indexOf(this.aAggregationLevel[i-1])<this.aMaxAggregationLevel.length-1};A.prototype.getFilterablePropertyNames=function(){return this.oAnalyticalQueryResult.getEntityType().getFilterablePropertyNames()};A.prototype.getPropertyLabel=function(p){return this.oAnalyticalQueryResult.getEntityType().getLabelOfProperty(p)};A.prototype.filter=function(f){this.aPropertyFilter=f;this.iTotalSize=-1;this.resetData();this._fireRefresh({reason:C.Filter});return this};A.prototype.sort=function(s){if(s instanceof S){s=[s]}this.aPropertySorter=s;this._fireRefresh({reason:C.Sort});return this};A.prototype.getGroupName=function(c,l){if(c===undefined)return"";var g=this.aAggregationLevel[l-1],d=this.oAnalyticalQueryResult.findDimensionByPropertyName(g),G=((d.getLabelText())?d.getLabelText()+': ':'')+c.getProperty(g),t=null;if(d){t=d.getTextProperty()}if(t){var s=c.getProperty(d.getTextProperty().name);if(s){G+=' - '+s}}var i=this.getGroupSize(c,l);if(i>-1){G+=' ('+i+')'}return G};A.prototype.updateAnalyticalInfo=function(c){this.aAnalyticalInfo=c;this.mAnalyticalInfoByProperty=new Object();this.aMaxAggregationLevel=new Array();this.aAggregationLevel=new Array();this.aMeasureName=new Array();this.iAnalyticalInfoVersionNumber=(this.iAnalyticalInfoVersionNumber===undefined?1:(this.iAnalyticalInfoVersionNumber>999?1:this.iAnalyticalInfoVersionNumber+1));this.oMeasureDetailsSet=new Object();this.oDimensionDetailsSet=new Object();if(c.length!=this.aAnalyticalInfo.length)this.iTotalSize=-1;for(var i=0;i<c.length;i++){var d=this.oAnalyticalQueryResult.findDimensionByPropertyName(c[i].name);if(d&&(c[i].inResult==true||c[i].visible==true)){c[i].dimensionPropertyName=d.getName();var D=this.oDimensionDetailsSet[d.getName()];if(!D){D=new Object();D.name=d.getName();D.aAttributeName=new Array();this.oDimensionDetailsSet[d.getName()]=D;this.aMaxAggregationLevel.push(D.name);if(c[i].grouped==true)this.aAggregationLevel.push(D.name)}if(d.getName()==c[i].name){D.keyPropertyName=c[i].name}var t=d.getTextProperty();if(t&&t.name==c[i].name){D.textPropertyName=c[i].name}if(d.findAttributeByName(c[i].name)){D.aAttributeName.push(c[i].name)}}var m=this.oAnalyticalQueryResult.findMeasureByPropertyName(c[i].name);if(m&&(c[i].inResult==true||c[i].visible==true)){c[i].measurePropertyName=m.getName();var M=this.oMeasureDetailsSet[m.getName()];if(!M){M=new Object();M.name=m.getName();this.oMeasureDetailsSet[m.getName()]=M;this.aMeasureName.push(M.name)}if(m.getRawValueProperty().name==c[i].name){M.rawValuePropertyName=c[i].name}var f=m.getFormattedValueProperty();if(f&&f.name==c[i].name){M.formattedValuePropertyName=c[i].name}}this.mAnalyticalInfoByProperty[c[i].name]=c[i]}var M;for(var a in this.oMeasureDetailsSet){var u=this.oAnalyticalQueryResult.findMeasureByName(a).getUnitProperty();if(u)this.oMeasureDetailsSet[a].unitPropertyName=u.name}this.mFinalLength={};this.mLength={};this.mKey={};this.mContexts={};this.bNeedsUpdate=false};A.prototype.getAnalyticalInfoForColumn=function(c){return this.mAnalyticalInfoByProperty[c]};A.prototype.loadGroups=function(g){var G=new Array();for(var s in g){G.push(s);delete this.mKey[s];delete this.mLength[s];delete this.mFinalLength[s];var a=g[s];for(var i=0;i<a.length;i++){var b=a[i];this._getContextsForParentGroupId(s,b.startIndex,b.length,b.threshold)}var r=new Array();for(var i=-1,s;s=G[++i];){r.push(this._getRequestIdForGroupMembersQuery(s))}this._considerRequestGrouping(r)}};A.prototype.getAnalyticalQueryResult=function(){return this.oAnalyticalQueryResult};A._requestType={groupMembersQuery:1,totalSizeQuery:2};A.prototype._getContextsForParentContext=function(p,s,l,t,L){if(p===undefined)return[];if(p&&p.getPath()=="/artificialRootContent"){p=this.getModel().getContext("/")}var P=this._getGroupIdFromContext(p,L);return this._getContextsForParentGroupId(P,s,l,t)};A.prototype._getContextsForParentGroupId=function(p,s,l,t){if(p===undefined)return[];if(!s)s=0;if(!l)l=this.oModel.iSizeLimit;if(this.mFinalLength[p]&&this.mLength[p]<l)l=this.mLength[p];if(!t)t=0;var c=this._getLoadedContextsForGroup(p,s,l);var a=this._calculateSection(p,s,l,t,c);var L=c.length!=l&&!(this.mFinalLength[p]&&c.length>=this.mLength[p]-s);if(!L)this._cleanupGroupingForCompletedRequest(this._getRequestIdForGroupMembersQuery(p));if(this.oModel.getServiceMetadata()){if(!this._isRequestPending(this._getRequestIdForGroupMembersQuery(p))&&L){if(this.bUseBatchRequests){this.aRequestQueue.push([A._requestType.groupMembersQuery,p,a.startIndex,a.length]);if(this.iTotalSize==-1&&!this._isRequestPending(this._getRequestIdForTotalSizeQuery())){this._considerRequestGrouping([this._getRequestIdForGroupMembersQuery(p),this._getRequestIdForTotalSizeQuery()]);this.aRequestQueue.push([A._requestType.totalSizeQuery])}q.sap.delayedCall(0,this,A.prototype._processRequestQueue)}else{this._executeQueryRequest(this._prepareGroupMembersQueryRequest(A._requestType.groupMembersQuery,p,a.startIndex,a.length));if(this.iTotalSize==-1&&!this._isRequestPending(this._getRequestIdForTotalSizeQuery())){this._considerRequestGrouping([this._getRequestIdForGroupMembersQuery(p),this._getRequestIdForTotalSizeQuery()]);this._executeQueryRequest(this._prepareTotalSizeQueryRequest(A._requestType.totalSizeQuery))}}}}return c};A.prototype._processRequestQueue=function(){if(this.aRequestQueue.length==0)return;var r=[];for(var i=-1,R;R=this.aRequestQueue[++i];){var a=null;switch(R[0]){case A._requestType.groupMembersQuery:a=A.prototype._prepareGroupMembersQueryRequest.apply(this,R);break;case A._requestType.totalSizeQuery:a=A.prototype._prepareTotalSizeQueryRequest.apply(this,R);break;default:q.sap.log.fatal("unhandled request type "+this.aRequestQueue[i][0]);continue}r.push(a)}if(r.length>1)this._executeBatchRequest(r);else this._executeQueryRequest(r[0]);this.aRequestQueue=[]};A.prototype._prepareGroupMembersQueryRequest=function(r,g,s,l){var G=[];var c=this.iAnalyticalInfoVersionNumber;var a=new o.QueryResultRequest(this.oAnalyticalQueryResult);a.setResourcePath(this.sPath);var b=0,d=-1;if(g){G=g.split("/");b=d=G.length-2;var u=0;for(var i=0,L=0;i<b;L++){if(this.mAnalyticalInfoByProperty[this.aMaxAggregationLevel[L]].grouped==false)++u;else++i}b=d=b+u;while(this.mAnalyticalInfoByProperty[this.aMaxAggregationLevel[d]].grouped==false)if(++d==this.aMaxAggregationLevel.length)break}var e=this.aMaxAggregationLevel.slice(0,d+1);a.setAggregationLevel(e);for(var i=0;i<e.length;i++){var D=this.oDimensionDetailsSet[e[i]];var I=(D.keyPropertyName!=undefined);var f=(D.textPropertyName!=undefined);a.includeDimensionKeyTextAttributes(D.name,true,f,D.aAttributeName)}var h=a.getFilterExpression();h.clear();if(this.aGlobalFilter)h.addUI5FilterConditions(this.aGlobalFilter);if(this.aPropertyFilter)h.addUI5FilterConditions(this.aPropertyFilter);if(b>=1){for(var i=1;i<G.length-1;i++){var p=G[i];h.addCondition(this.aAggregationLevel[i-1],F.EQ,p)}}var j=!(this.aMaxAggregationLevel.length-d-1>0);var k;var m;var n;var M;var t=new Array();a.setMeasures(this.aMeasureName);for(var v in this.oMeasureDetailsSet){M=this.oMeasureDetailsSet[v];if(!j&&this.mAnalyticalInfoByProperty[v].total==false){k=false;m=false;n=false}else{k=(M.rawValuePropertyName!=undefined);m=(M.formattedValuePropertyName!=undefined);n=(M.unitPropertyName!=undefined);if(n){if(t.indexOf(M.unitPropertyName)==-1){t.push(M.unitPropertyName)}}}a.includeMeasureRawFormattedValueUnit(M.name,k,m,n)}for(var i in e){var w;if((w=t.indexOf(e[i]))!=-1)t.splice(w,1)}var x=a.getSortExpression();x.clear();if(!j){for(var i in e){var y=o.SortOrder.Ascending;if(this.mAnalyticalInfoByProperty[e[i]].sorted)switch(this.mAnalyticalInfoByProperty[e[i]].sortOrder){case sap.ui.table.SortOrder.Ascending:y=o.SortOrder.Ascending;break;case sap.ui.table.SortOrder.Descending:y=o.SortOrder.Descending;break}x.addSorter(e[i],y)}}if(this.aGlobalSorter)this._applyUI5SorterToSortExpression(this.aGlobalSorter,x);if(this.aPropertySorter)this._applyUI5SorterToSortExpression(this.aPropertySorter,x);if(l==0)q.sap.log.fatal("unhandled case: load 0 entities of sub group");a.setResultPageBoundaries(s+1,s+l);a.setRequestOptions(null,!this.mFinalLength[g]);return{iRequestType:r,sRequestId:this._getRequestIdForGroupMembersQuery(g),oAnalyticalQueryRequest:a,sGroupId:g,aSelectedUnitPropertyName:t,aAggregationLevel:e,iStartIndex:s,iLength:l}};A.prototype._prepareTotalSizeQueryRequest=function(r){var g=[];var c=this.iAnalyticalInfoVersionNumber;var a=new o.QueryResultRequest(this.oAnalyticalQueryResult);a.setResourcePath(this.sPath);a.setAggregationLevel(this.aMaxAggregationLevel);a.setMeasures([]);var f=a.getFilterExpression();f.clear();if(this.aGlobalFilter)f.addUI5FilterConditions(this.aGlobalFilter);a.setResultPageBoundaries(1,1);a.setRequestOptions(null,true);return{iRequestType:r,sRequestId:this._getRequestIdForTotalSizeQuery(),oAnalyticalQueryRequest:a,}};A.prototype._getQueryODataRequestOptions=function(a){var s=a.getURIQueryOptionValue("$select");var f=a.getURIQueryOptionValue("$filter");var O=a.getURIQueryOptionValue("$orderby");var b=a.getURIQueryOptionValue("$skip");var t=a.getURIQueryOptionValue("$top");var i=a.getURIQueryOptionValue("$inlinecount");if(this.mParameters["filter"])f+="and ("+this.mParameters["filter"]+")";var p=[];if(s)p.push("$select="+s);if(f)p.push("$filter="+f);if(O)p.push("$orderby="+O);if(b)p.push("$skip="+b);if(t)p.push("$top="+t);if(i)p.push("$inlinecount="+i);return p};A.prototype._executeBatchRequest=function(r){var c=this.iAnalyticalInfoVersionNumber;var t=this;var b=[],e=[];for(var i=-1,R;R=r[++i];){var a=R.oAnalyticalQueryRequest,g=R.sGroupId;if(a.getURIQueryOptionValue("$select")==null){this.fireDataRequested();var E=this.getModel().getContext("/artificialRootContent");g=null;this.mLength[g]=1;this.mFinalLength[g]=true;this.mKey[g]=["artificialRootContent"];this.bNeedsUpdate=true;var t=this;setTimeout(function(){t.fireDataReceived()});this.bArtificalRootContext=true;continue}var p=a.getURIToQueryResultEntries();if(p.indexOf("/")==0)p=p.substring(1);if(!this._isRequestPending(R.sRequestId)){this._registerNewRequest(R.sRequestId);b.push(this.oModel.createBatchOperation(p.replace(/\ /g,"%20"),"GET"));e.push(R)}}q.sap.log.debug("AnalyticalBinding: executing batch request with "+e.length+" operations");this.oModel.addBatchReadOperations(b);this.fireDataRequested();var d=this.oModel.submitBatch(s,f,true,true);function s(D,h){if(e.length!=D.__batchResponses.length)q.sap.log.fatal("assertion failed: received "+D.__batchResponses.length+" responses for "+e.length+" read operations in the batch request");if(c!=t.iAnalyticalInfoVersionNumber){t.oRequestHandle=null;for(var i=-1,j;j=e[++i].sRequestId;){t._deregisterCompletedRequest(j);t._cleanupGroupingForCompletedRequest(j)}return}for(var i=0;i<D.__batchResponses.length;i++){if(D.__batchResponses[i].data!=undefined){switch(e[i].iRequestType){case A._requestType.groupMembersQuery:t._processGroupMembersQueryResponse(e[i],D.__batchResponses[i].data);break;case A._requestType.totalSizeQuery:t._processTotalSizeQueryResponse(e[i],D.__batchResponses[i].data);break;default:q.sap.log.fatal("invalid request type "+e[i].iRequestType);continue}}t.oRequestHandle=null;t._deregisterCompletedRequest(e[i].sRequestId);t._cleanupGroupingForCompletedRequest(e[i].sRequestId)}var O=true;var B=t.oModel._getBatchErrors(D);if(B.length>0)O=false;t.oModel.fireRequestCompleted({url:h.requestUri,type:"POST",async:true,info:"",infoObject:{},success:O,errorobject:O?{}:t.oModel._handleError(B[0])});if(O)t._fireChange({reason:C.Change});t.fireDataReceived()}function f(h){t.oRequestHandle=null;for(var i=-1,j;j=e[++i];){t._deregisterCompletedRequest(j.sRequestId);t._cleanupGroupingForCompletedRequest(j.sRequestId)}if(c!=t.iAnalyticalInfoVersionNumber){return}t.oModel.fireRequestCompleted({url:"",type:"POST",async:true,info:"",infoObject:{},success:false,errorobject:t.oModel._handleError(h)});t.fireRequestFailed(t.oModel._handleError(h));t.fireDataReceived()}};A.prototype._executeQueryRequest=function(r){var c=this.iAnalyticalInfoVersionNumber;var a=r.oAnalyticalQueryRequest,g=r.sGroupId;var p=a.getURIToQueryResultEntitySet();var P=this._getQueryODataRequestOptions(a);var t=this;if(a.getURIQueryOptionValue("$select")==null){this.fireDataRequested();var e=this.getModel().getContext("/artificialRootContent");g=null;this.mLength[g]=1;this.mFinalLength[g]=true;this.mKey[g]=["artificialRootContent"];this.bNeedsUpdate=true;var t=this;setTimeout(function(){if(t._cleanupGroupingForCompletedRequest(r.sRequestId))t.fireDataReceived()});this.bArtificalRootContext=true;return}this._registerNewRequest(r.sRequestId);this.fireDataRequested();for(var i=0;i<P.length;i++)P[i]=P[i].replace(/\ /g,"%20");q.sap.log.debug("AnalyticalBinding: executing query request");this.oModel._loadData(p,P,s,E,false,u,f);function s(d){if(c!=t.iAnalyticalInfoVersionNumber){t.oRequestHandle=null;t._deregisterCompletedRequest(r.sRequestId);return}switch(r.iRequestType){case A._requestType.groupMembersQuery:t._processGroupMembersQueryResponse(r,d);break;case A._requestType.totalSizeQuery:t._processTotalSizeQueryResponse(r,d);break;default:q.sap.log.fatal("invalid request type "+r.iRequestType);break}t.oRequestHandle=null;t._deregisterCompletedRequest(r.sRequestId)}function f(){if(c!=t.iAnalyticalInfoVersionNumber){return}if(t._cleanupGroupingForCompletedRequest(r.sRequestId))t.fireDataReceived()}function E(d){t.oRequestHandle=null;t._deregisterCompletedRequest(r.sRequestId);t._cleanupGroupingForCompletedRequest(r.sRequestId);if(c!=t.iAnalyticalInfoVersionNumber){return}t.fireDataReceived()}function u(h){t.oRequestHandle=h}};A.prototype._processGroupMembersQueryResponse=function(r,d){var a=r.oAnalyticalQueryRequest,g=r.sGroupId,s=r.aSelectedUnitPropertyName,b=r.aAggregationLevel,c=r.iStartIndex,l=r.iLength;if(!this.mKey[g])this.mKey[g]=[];var K=this.mKey[g];var e=c;var u=(s.length>0);var p=null,D=null;var f=-1;var h=0;var m=null;for(var i=0;i<d.results.length;i++){var E=d.results[i];if(u){D="";for(var j=0;j<b.length;j++){D+=E[b[j]]+"|"}if(p==D){if(f==-1)f=i-1;var n=-1,P=d.results[i-1];for(var k=0;k<s.length;k++){if(P[s[k]]!=E[s[k]]){n=k;break}}if(n==-1)q.sap.log.fatal("assertion failed: no deviating units found for result entries "+(i-1)+" and "+i)}if((p!=D||i==d.results.length-1)&&f!=-1){var M=q.extend(true,{},d.results[f]);var t=this.oModel._getObject("/"+this.oModel._getKey(d.results[f]));for(var k=0;k<s.length;k++)M[s[k]]="*";for(var v in this.oMeasureDetailsSet){var w=this.oMeasureDetailsSet[v];if(w.rawValuePropertyName!=undefined)M[w.rawValuePropertyName]="*";if(w.formattedValuePropertyName!=undefined)M[w.formattedValuePropertyName]="*"}var x="";if(m==null)m=this.oAnalyticalQueryResult.getAllDimensionNames().concat([]).sort();for(var k=0;k<m.length;k++){var y=M[m[k]];x+=(y===undefined?"":y)+","}M.__metadata.uri=x+"-multiple-units-not-dereferencable";delete M.__metadata[self];M["^~volatile"]=true;this.oModel._importData(M,{});this.oModel.getContext('/'+M.__metadata.uri)["_volatile"]=true;K[e-1]=this.oModel._getKey(M);h+=((i-(i!=d.results.length-1?1:0))-f);f=-1;if(p!=D)K[e++]=this.oModel._getKey(E)}else if(p!=D)K[e++]=this.oModel._getKey(E);p=D}else K[e++]=this.oModel._getKey(E)}if(d.__count){this.mLength[g]=parseInt(d.__count,10)-h;this.mFinalLength[g]=true}if(this.mLength[g]<c+d.results.length){this.mLength[g]=c+(d.results.length-h);this.mFinalLength[g]=false}if((d.results.length-h)<l||l===undefined){this.mLength[g]=c+(d.results.length-h);this.mFinalLength[g]=true}if(d.results.length==0){this.mLength[g]=0;this.mFinalLength[g]=true}this.bNeedsUpdate=true};A.prototype._processTotalSizeQueryResponse=function(r,d){var a=r.oAnalyticalQueryRequest;if(d.__count==undefined){q.sap.log.fatal("missing entity count in query result");return}this.iTotalSize=d.__count};A.prototype._getLoadedContextsForGroup=function(g,s,l){var c=[],a,k=this.mKey[g],K;if(!k)return c;if(!s)s=0;if(!l){l=this.oModel.iSizeLimit;if(this.mFinalLength[g]&&this.mLength[g]<l)l=this.mLength[g]}for(var i=s;i<s+l;i++){K=k[i];if(!K){break}a=this.oModel.getContext('/'+K);c.push(a)}return c};A.prototype._calculateSection=function(g,s,l,t,c){var L=false,a,b,p,P,r,d={},k=this.mKey[g],K;b=s;a=0;if(!k){P=s;p=s+l}else{for(var i=s-1;i>=Math.max(s-t,0);i--){K=k[i];if(!K){P=i+1;break}}for(var j=s+l;j<s+l+t;j++){K=k[j];if(!K){p=j;break}}}r=s-P;if(P&&s>t&&r<t){if(c.length!=l)b=s-t;else b=P-t;a=t}if(b==s)b+=c.length;if(c.length!=l)a+=l-c.length;r=p-s-l;if(r==0)a+=t;if(p&&r<t&&r>0){if(b>=s){b=p;a+=t}}if(this.mFinalLength[g]&&this.mLength[g]<(a+b))a=this.mLength[g]-b;d.startIndex=b;d.length=a;return d};A.prototype._getEntitySetFromPath=function(){var e=this.sPath.split("/")[1];if(e.indexOf("(")!=-1){e=e.split("(")[0]+"Results"}return e};A.prototype._getGroupIdFromContext=function(c,l){if(!c){return null}var g="/";var d=null;if(l>this.aAggregationLevel.length)q.sap.log.fatal("assertion failed: aggregation level deeper than number of current aggregation levels");for(var i=0;i<l;i++){d=c.getProperty(this.aAggregationLevel[i]);if(d!=null){g+=d+"/"}else q.sap.log.fatal("assertion failed: value of property included in aggregation level is null")}return g};A.prototype._applyUI5SorterToSortExpression=function(s,a){if(s){for(var i in s){var p=this.mAnalyticalInfoByProperty[s[i].sPath];if(p===undefined||p==null)q.sap.log.fatal("assertion failed: sorting property "+s[i].sPath+" not found in analytical info");a.addSorter(s[i].sPath,s[i].bDescending?o.SortOrder.Descending:o.SortOrder.Ascending)}}};A.prototype._getRequestIdForGroupMembersQuery=function(g){return A._requestType.groupMembersQuery+(g==null?"":g)};A.prototype._getRequestIdForTotalSizeQuery=function(){return A._requestType.totalSizeQuery};A.prototype._registerNewRequest=function(r){if(r==undefined||r==""){q.sap.log.fatal("missing request ID");return}if(!this.oPendingRequests[r])this.oPendingRequests[r]=1;else++this.oPendingRequests[r]};A.prototype._considerRequestGrouping=function(r){for(var i=-1,R;R=r[++i];){if(this.oGroupedRequests[R]===undefined)this.oGroupedRequests[R]={};var g=this.oGroupedRequests[R];for(var j=0;j<r.length;j++)g[r[j]]=true}};A.prototype._isRequestPending=function(r){return this.oPendingRequests[r]!=undefined&&this.oPendingRequests[r]>0};A.prototype._deregisterCompletedRequest=function(r){if(!this.oPendingRequests[r])q.sap.log.fatal("assertion failed: there is no pending request ID "+r);if(this.oPendingRequests[r]==1)delete this.oPendingRequests[r];else--this.oPendingRequests[r]};A.prototype._cleanupGroupingForCompletedRequest=function(r){if(this._isRequestPending(r))return false;var g=true;if(this.oGroupedRequests[r]!=undefined){for(var O in this.oGroupedRequests[r]){if(this.oPendingRequests[O]){g=false;break}}}if(g){var R=this.oGroupedRequests[r];delete this.oGroupedRequests[r];for(var O in R){if(O!=r)this._cleanupGroupingForCompletedRequest(O)}}return g};A.prototype.resetData=function(c){if(c){var p=c.getPath();delete this.mKey[p];delete this.mLength[p];delete this.mFinalLength[p]}else{this.mKey={};this.mLength={};this.mFinalLength={}}};A.prototype.refresh=function(f,c,e){var b=false;if(!f){if(e){var r=this.oModel.resolve(this.sPath,this.oContext);var E=this.oModel.oMetadata._getEntityTypeByPath(r);if(E&&(E.entityType in e))b=true}if(c&&!b){q.each(this.mKey,function(i,n){q.each(n,function(i,k){if(k in c){b=true;return false}});if(b)return false})}if(!c&&!e){b=true}}if(f||b){this.resetData();this.bNeedsUpdate=false;this._fireRefresh({reason:sap.ui.model.ChangeReason.Refresh})}};A.prototype.checkUpdate=function(f,c){var b=false;if(!f){if(this.bNeedsUpdate||!c){b=true}else{q.each(this.mKey,function(i,n){q.each(n,function(i,k){if(k in c){b=true;return false}});if(b)return false})}}if(f||b){this.bNeedsUpdate=false;this._fireChange()}};return A},true);
