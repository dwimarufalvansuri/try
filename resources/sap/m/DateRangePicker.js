/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.m.DateRangePicker");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.m.DatePicker");sap.m.DatePicker.extend("sap.m.DateRangePicker",{metadata:{library:"sap.m",properties:{"delimiter":{type:"string",group:"Misc",defaultValue:null},"secondDateValue":{type:"object",group:"Data",defaultValue:null},"isStartingDateRangePicker":{type:"boolean",group:"Misc",defaultValue:null}},events:{"change":{}}}});sap.m.DateRangePicker.M_EVENTS={'change':'change'};
sap.m.DateRangePicker.prototype.init=function(){this.setProperty("valueFormat",null,true)};
jQuery.sap.require("sap.ui.model.type.Date");(function(){sap.m.DateRangePicker.prototype._getPlaceholder=function(){var p=this.getPlaceholder();if(!p){p=this.getDisplayFormat();if(!p){p="medium"}if(p=="short"||p=="medium"||p=="long"){var l=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var L=sap.ui.core.LocaleData.getInstance(l);p=L.getDatePattern(p)}if(this.getDelimiter()&&this.getDelimiter()!=""){p=p+" "+this.getDelimiter()+" "+p}}return p};sap.m.DateRangePicker.prototype.setValue=function(v){if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);this._parseValue(v);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangePicker.prototype.setDateValue=function(D){this.setProperty("dateValue",D,true);var v=this._formatValue(true);if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangePicker.prototype.setSecondDateValue=function(s){this.setProperty("secondDateValue",s,true);var v=this._formatValue(true);if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangePicker.prototype._parseValue=function(v,D){var i="";var F;var j="";if((this.getDelimiter()&&(this.getDelimiter()!=""))&&v){j=v.split(" "+this.getDelimiter()+" ")}if(((!this.getDelimiter()||(this.getDelimiter()==""))&&v)||(this.getDelimiter()&&(this.getDelimiter()!="")&&v&&j&&(j.length==2))){i=this.getDisplayFormat();if(!i){if(D){i="medium"}else{i="short"}}if(i=="short"||i=="medium"||i=="long"){F=sap.ui.core.format.DateFormat.getInstance({style:i})}else{F=sap.ui.core.format.DateFormat.getInstance({pattern:i})}if((!this.getDelimiter()||(this.getDelimiter()==""))&&v){this.setProperty("dateValue",F.parse(v),true)}else if(j!=""){if((F.parse(j[0])==null)||(F.parse(j[1])==null)){this.setProperty("dateValue",null,true);this.setProperty("secondDateValue",null,true)}else{this.setProperty("dateValue",F.parse(j[0]),true);this.setProperty("secondDateValue",F.parse(j[1]),true)}}}else{this.setProperty("dateValue",null,true);this.setProperty("secondDateValue",null,true)}};sap.m.DateRangePicker.prototype._formatValue=function(v,D,o){var i;var s;if(D){i=D}else{i=this.getProperty("dateValue")}if(o){s=o}else{s=this.getProperty("secondDateValue")}var V="";if(((!this.getDelimiter()||(this.getDelimiter()==""))&&i)||(this.getDelimiter()&&(this.getDelimiter()!="")&&i&&s)){var O="";var F;O=this.getDisplayFormat();if(!O){if(v){O="short"}else{O="medium"}}if(O=="short"||O=="medium"||O=="long"){F=sap.ui.core.format.DateFormat.getInstance({style:O})}else{F=sap.ui.core.format.DateFormat.getInstance({pattern:O})}if(!this.getDelimiter()||(this.getDelimiter()=="")){if(s){if(this.getIsStartingDateRangePicker()==true){if(i>s){i=null}}else{if(i<s){i=null}}}if(i==null){V=""}else{V=F.format(i)}}else if(this.getDelimiter()&&(this.getDelimiter()!="")){V=F.format(i)+" "+this.getDelimiter()+" "+F.format(s)}}return V};sap.m.DateRangePicker.prototype.onChange=function(E){var D=this.getDateValue();var s=this.getSecondDateValue();this._getInputValue();g(this,D,s);var v=this._formatValue(true);if(v!==this._lastValue){if(this.getDomRef()){this._$input.val(v)}this.setProperty("value",v,true);this._curpos=this._$input.cursorPos();this._setLabelVisibility();this._lastValue=v;f(this)}};sap.m.DateRangePicker.prototype._getInputValue=function(){var v=this._$input.val();this._parseValue(v,true);v=this._formatValue(true);return v};sap.m.DateRangePicker.prototype.onclick=function(E){if(jQuery(E.target).hasClass("sapUiIcon")){this.onChange(E);var t=this;a(t)}};sap.m.DateRangePicker.prototype.onfocusin=function(E){if(sap.ui.Device.browser.mobile&&!jQuery(E.target).hasClass("sapUiIcon")){var t=this;a(t)}};sap.m.DateRangePicker.prototype.onfocusout=function(E){this.onChange(E)};sap.m.DateRangePicker.prototype.onsapshow=function(E){var t=this;a(t);E.preventDefault()};sap.m.DateRangePicker.prototype.onsapenter=function(E){this.onChange(E)};sap.m.DateRangePicker.prototype.onsappageup=function(E){var t=this;if(e(t)){d(t,1,"day")}};sap.m.DateRangePicker.prototype.onsappageupmodifiers=function(E){var t=this;if(e(t)){if(!E.ctrlKey&&E.shiftKey){d(t,1,"month")}else{d(t,1,"year")}}};sap.m.DateRangePicker.prototype.onsappagedown=function(E){var t=this;if(e(t)){d(t,-1,"day")}};sap.m.DateRangePicker.prototype.onsappagedownmodifiers=function(E){var t=this;if(e(t)){if(!E.ctrlKey&&E.shiftKey){d(t,-1,"month")}else{d(t,-1,"year")}}};function _(t){if(!t._oPopup){jQuery.sap.require("sap.ui.core.Popup");t._oPopup=new sap.ui.core.Popup();t._oPopup.setAutoClose(true);t._oPopup.setDurations(0,0)}if(!t._oCalendar){sap.ui.getCore().loadLibrary("sap.ui.unified");jQuery.sap.require("sap.ui.unified.library");t._oCalendar=new sap.ui.unified.Calendar(t.getId()+"-cal",{intervalSelection:true});t._oDateRange=new sap.ui.unified.DateRange();t._oCalendar.addSelectedDate(t._oDateRange);t._oCalendar.attachSelect(b,t);t._oCalendar.attachCancel(c,t);t._oPopup.setContent(t._oCalendar)}var s;var E;if((!t.getDelimiter()||(t.getDelimiter()==""))&&(t.getProperty("isStartingDateRangePicker")==false)){s=t.getSecondDateValue();E=t.getDateValue()}else{s=t.getDateValue();E=t.getSecondDateValue()}if(s){if(!t._oDateRange.getStartDate()||t._oDateRange.getStartDate().getTime()!=s.getTime()){t._oDateRange.setStartDate(new Date(s.getTime()))}}else{if(t._oDateRange.getStartDate()){t._oDateRange.setStartDate(undefined)}}if(E){if(!t._oDateRange.getEndDate()||t._oDateRange.getEndDate().getTime()!=E.getTime()){t._oDateRange.setEndDate(new Date(E.getTime()))}}else{if(t._oDateRange.getEndDate()){t._oDateRange.setEndDate(undefined)}}t._oPopup.setAutoCloseAreas([t.getDomRef()]);var i=sap.ui.core.Popup.Dock;t._oPopup.open(0,i.BeginTop,i.BeginBottom,t,null,null,true)};function a(t){if(t.getEditable()&&t.getEnabled()){if(!t._oPopup||!t._oPopup.isOpen()){_(t)}else{t._oPopup.close()}}};function b(E){var s=this._oCalendar.getSelectedDates();if(s.length>0){var D;var o;if((!this.getDelimiter()||(this.getDelimiter()==""))&&(this.getProperty("isStartingDateRangePicker")==false)){D=s[0].getEndDate();o=s[0].getStartDate()}else{D=s[0].getStartDate();o=s[0].getEndDate()}if(D&&o){if(!this.getDelimiter()||(this.getDelimiter()=="")){this.setProperty("secondDateValue",o,true)}var O=this._formatValue(false,D,o);if(this._$input.val()!==O){this._$input.val(O);this._setLabelVisibility();this._curpos=O.length;this._$input.cursorPos(this._curpos)}this._oPopup.close();this.focus();this.onChange()}}};function c(E){if(this._oPopup&&this._oPopup.isOpen()){this._oPopup.close();this.focus()}};function d(t,n,u){var o=t.getDateValue();if(o&&t.getEditable()&&t.getEnabled()){var D=new Date(o.getTime());switch(u){case"day":D.setDate(D.getDate()+n);break;case"month":D.setMonth(D.getMonth()+n);break;case"year":D.setFullYear(D.getFullYear()+n);break;default:break}t.setDateValue(D);f(t)}};function e(t){if(t.getDelimiter()&&(t.getDelimiter()!="")){return false}else{return true}};function f(t){var i=null;var j=null;if(t.getDelimiter()&&(t.getDelimiter()!="")){i=t.getDateValue();j=t.getSecondDateValue()}else{if(t.getIsStartingDateRangePicker()!=null){if(t.getIsStartingDateRangePicker()==true){i=t.getDateValue();j=t.getSecondDateValue()}else{i=t.getSecondDateValue();j=t.getDateValue()}}}t.fireChange({from:i,to:j})};function g(t,D,s){var i=t.getDateValue();var j=t.getSecondDateValue();if((t.getDelimiter()==null)||(t.getDelimiter()=="")){if((t.getIsStartingDateRangePicker()!=null)&&(i!=null)&&(j!=null)){if(t.getIsStartingDateRangePicker()==true){if(!h(i,j)){t.setProperty("secondDateValue",i,true)}}else{if(!h(j,i)){t.setProperty("secondDateValue",i,true)}}}}else{if((i!=null)&&(j!=null)&&(!h(i,j))){if((D!=null)&&(i.getTime()==D.getTime())){t.setProperty("dateValue",j,true)}else if((s!=null)&&(j.getTime()==s.getTime())){t.setProperty("secondDateValue",i,true)}else{t.setProperty("secondDateValue",i,true)}}}};function h(i,t){if(i.getTime()<t.getTime()){return true}else{return false}}}());
